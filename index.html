<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongolVibes</title>
    <meta name="description" content="Experience the best Mongolian Minecraft server. Custom terrain, player-driven economy, and a community that feels like home.">
    <meta name="keywords" content="MongolVibes, Minecraft, Mongolia, Survival, SMP, Lifesteal, Server">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mnvibes.org/">
    <meta property="og:title" content="MongolVibes | Survival Redefined">
    <meta property="og:description" content="Join Season XI. A return to roots. Pure Vanilla Survival with a roadmap of massive expansions.">
    <meta property="og:image" content="https://i.ibb.co/cS7GGFrF/Picsart-26-01-03-14-31-23-675.jpg">
    
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://mnvibes.org/">
    <meta property="twitter:title" content="MongolVibes | Survival Redefined">
    <meta property="twitter:description" content="Join Season XI. A return to roots. Pure Vanilla Survival with a roadmap of massive expansions.">
    <meta property="twitter:image" content="https://i.ibb.co/cS7GGFrF/Picsart-26-01-03-14-31-23-675.jpg">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&family=Silkscreen&display=swap');
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['IBM Plex Sans', 'sans-serif'],
                        pixel: ['Silkscreen', 'cursive'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        brand: {
                            bg: '#09090b', 
                            card: '#18181b', 
                            accent: '#3b82f6', 
                            hyper: '#db2777',
                            bypass: '#ef4444', 
                            discord: '#5865F2',
                            surface: '#27272a',
                            border: '#3f3f46',
                            ice: '#3b82f6',
                            // Season XI Specific Palette
                            xi: {
                                orange: '#f97316',
                                gold: '#fbbf24',
                                dark: '#0c0a09',
                                panel: '#1c1917'
                            }
                        }
                    },
                    animation: {
                        'enter-slide': 'enterSlide 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'glitch': 'glitch 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite',
                        'fade-in': 'fadeIn 0.5s ease-in-out forwards',
                        'pan-bg': 'panBg 60s linear infinite alternate',
                        'shimmer': 'shimmer 2s linear infinite',
                    },
                    keyframes: {
                        enterSlide: {
                            '0%': { opacity: '0', transform: 'scale(0.95) translateY(10px)' },
                            '100%': { opacity: '1', transform: 'scale(1) translateY(0)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        glitch: {
                            '0%': { transform: 'translate(0)' },
                            '20%': { transform: 'translate(-2px, 2px)' },
                            '40%': { transform: 'translate(-2px, -2px)' },
                            '60%': { transform: 'translate(2px, 2px)' },
                            '80%': { transform: 'translate(2px, -2px)' },
                            '100%': { transform: 'translate(0)' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        panBg: {
                            '0%': { backgroundPosition: '0% 50%' },
                            '100%': { backgroundPosition: '100% 50%' }
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-1000px 0' },
                            '100%': { backgroundPosition: '1000px 0' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050505;
            color: #e4e4e7;
            cursor: default;
            font-family: 'IBM Plex Sans', sans-serif;
            overflow-x: hidden;
        }

        /* NEW: Background Layer Animations */
        .bg-layer {
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transform: scale(1.1);
            transition: opacity 1.2s ease-in-out, transform 12s ease-out;
            z-index: 0;
            /* Changed to simple dark tint (brightness reduction) only */
            filter: brightness(0.4);
        }
        .bg-layer.active {
            opacity: 1;
            transform: scale(1);
        }

        /* Title Glow Effect */
        .title-glow {
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.5), 0 0 40px rgba(59, 130, 246, 0.3);
            animation: pulseGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes pulseGlow {
            0% { text-shadow: 0 0 20px rgba(59, 130, 246, 0.5), 0 0 40px rgba(59, 130, 246, 0.3); }
            100% { text-shadow: 0 0 30px rgba(59, 130, 246, 0.8), 0 0 60px rgba(59, 130, 246, 0.5); }
        }
        
        /* Season XI Specific Styles */
        .xi-glow-text {
            text-shadow: 0 0 20px rgba(249, 115, 22, 0.5), 0 0 40px rgba(249, 115, 22, 0.3);
        }
        
        .xi-gradient-text {
            background: linear-gradient(to right, #f97316, #fbbf24, #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .xi-card-border {
            border: 1px solid rgba(249, 115, 22, 0.2);
            box-shadow: 0 0 15px rgba(249, 115, 22, 0.05);
        }
        
        .xi-card-border:hover {
            border-color: rgba(249, 115, 22, 0.5);
            box-shadow: 0 0 30px rgba(249, 115, 22, 0.15);
        }

        .noise-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9000;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        h1, h2, h3, h4, h5, h6, .font-pixel {
            font-family: 'Silkscreen', cursive;
            letter-spacing: -0.04em;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #09090b; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #3b82f6; }

        .tilt-card {
            transform-style: preserve-3d;
            transform: perspective(1000px);
        }
        .tilt-inner {
            transform: translateZ(20px);
        }

        .card-indie {
            isolation: isolate;
            transform: translateZ(0); 
            -webkit-mask-image: -webkit-radial-gradient(white, black); 
            overflow: hidden;
            border-radius: 1rem; 
        }

        /* NEW CUSTOM SHAPE CLASS */
        .hero-shape-custom {
            clip-path: polygon(
                10% 0%, 
                100% 0%, 
                100% 85%, 
                90% 100%, 
                0% 100%, 
                0% 15%
            );
            filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.2));
        }

        .btn-glitch {
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        .btn-glitch:hover {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }
        .btn-glitch::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        .btn-glitch:hover::before {
            left: 100%;
        }

        .btn-glow-green:hover { box-shadow: 0 0 25px rgba(34, 197, 94, 0.6) !important; }
        .btn-glow-pink:hover { box-shadow: 0 0 25px rgba(219, 39, 119, 0.6) !important; }
        .btn-glow-red:hover { box-shadow: 0 0 25px rgba(239, 68, 68, 0.6) !important; }
        .btn-glow-purple:hover { box-shadow: 0 0 25px rgba(168, 85, 247, 0.6) !important; }
        .btn-glow-yellow:hover { box-shadow: 0 0 25px rgba(234, 179, 8, 0.6) !important; }

        .modal-glass {
            background: rgba(10, 10, 12, 0.85);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 
                0 40px 80px -12px rgba(0, 0, 0, 0.8),
                inset 0 0 0 1px rgba(255, 255, 255, 0.05),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
        }

        .grid-bg-anim {
            background-size: 40px 40px;
            background-image:
                linear-gradient(to right, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            animation: gridMove 20s linear infinite;
        }
        @keyframes gridMove {
            0% { background-position: 0 0; }
            100% { background-position: 40px 40px; }
        }

        .nav-menu { position: relative; }
        .nav-highlight {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            left: 0;
            height: 80%;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            pointer-events: none;
            z-index: 0;
            box-shadow: 0 0 15px rgba(255,255,255,0.05);
        }

        .splash-text {
            animation: splash-pulse 0.6s ease-in-out infinite alternate;
            transform-origin: center;
            position: absolute;
            right: -30px; 
            bottom: -5px;
            text-shadow: 2px 2px 0px #000, 0 0 10px rgba(250, 204, 21, 0.5);
            z-index: 20;
            pointer-events: none;
        }
        @keyframes splash-pulse {
            0% { transform: translateY(0) rotate(-20deg) scale(1); }
            100% { transform: translateY(0) rotate(-20deg) scale(1.15); }
        }

        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }
        
        .signal-bar { animation: signal-pulse 1.5s infinite; }
        .signal-bar:nth-child(2) { animation-delay: 0.2s; }
        .signal-bar:nth-child(3) { animation-delay: 0.4s; }
        @keyframes signal-pulse {
            0%, 100% { opacity: 0.3; height: 30%; }
            50% { opacity: 1; height: 100%; }
        }

        .player-head-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 250px;
            overflow-y: auto;
            padding: 4px;
        }
        
        .hover-lift {
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .hover-lift:hover {
            transform: translateY(-8px) scale(1.01);
            z-index: 10;
        }

        .win-btn {
            width: 40px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #a1a1aa;
            transition: all 0.1s;
        }
        .win-btn:hover {
            background-color: rgba(255,255,255,0.1);
            color: white;
        }
        .win-btn.close:hover {
            background-color: #ef4444; 
            color: white;
        }

        .markdown-body { font-family: 'IBM Plex Sans', sans-serif !important; }
        .markdown-body h1 { font-size: 1.5em; font-weight: bold; margin-bottom: 0.5em; color: white; }
        .markdown-body h2 { font-size: 1.25em; font-weight: bold; margin-bottom: 0.5em; color: white; margin-top: 1em; }
        .markdown-body p { margin-bottom: 1em; line-height: 1.6; color: #a1a1aa; font-family: 'IBM Plex Sans', sans-serif; }
        .markdown-body ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; color: #d4d4d8; }
        .markdown-body a { color: #3b82f6; text-decoration: underline; }
        .markdown-body blockquote { border-left: 4px solid #3f3f46; padding-left: 1em; color: #71717a; font-style: italic; }

        .news-reader-fullscreen {
            display: none;
            position: fixed;
            top: 96px; 
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 45; 
            background: #09090b; 
            background: rgba(9, 9, 11, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            flex-direction: column;
            animation: slideUpFade 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            overflow: hidden; 
        }
        .news-reader-fullscreen.active {
            display: flex;
        }

        #news-reader-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
            transition: transform 0.3s ease;
        }

        #news-content-area {
            padding-top: 50px; 
            height: 100%;
            overflow-y: auto;
        }

        @keyframes slideUpFade {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .tab-btn {
            position: relative;
            color: #71717a;
            transition: all 0.3s;
        }
        .tab-btn.active {
            color: #3b82f6;
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }
        .tab-btn::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #3b82f6;
            transform: scaleX(0);
            transition: transform 0.3s;
        }
        .tab-btn.active::after {
            transform: scaleX(1);
        }

        .news-card-clean {
            background: linear-gradient(180deg, rgba(24, 24, 27, 0.6) 0%, rgba(9, 9, 11, 0.9) 100%);
            border: 1px solid rgba(255, 255, 255, 0.03);
            transition: all 0.3s ease;
        }
        .news-card-clean:hover {
            border-color: rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
        }
        .news-card-clean .news-image {
            aspect-ratio: 21/9;
            object-fit: cover;
            mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
        }

        .carousel-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            border-radius: 0.5rem;
        }
        .carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.8s ease-in-out, transform 8s ease-out;
            transform: scale(1.05);
            object-fit: cover;
            pointer-events: none;
        }
        .carousel-slide.active {
            opacity: 1;
            transform: scale(1);
        }
        .carousel-dots {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.5rem;
            z-index: 20;
            transition: opacity 0.3s ease;
            opacity: 0;
        }
        .carousel-container:hover .carousel-dots {
            opacity: 1; 
        }
        .carousel-dot {
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 999px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .carousel-dot.active {
            background: #3b82f6;
            width: 24px;
        }
        
        .carousel-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent 40%);
            opacity: 0; 
            transition: opacity 0.3s ease;
            display: flex;
            align-items: flex-end; 
            justify-content: center;
            padding-bottom: 3rem; 
            z-index: 15;
            pointer-events: none;
        }
        .carousel-container:hover .carousel-overlay {
            opacity: 1;
        }
        
        .carousel-caption {
            background: rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(3px);
            padding: 0.25rem 0.8rem;
            border-radius: 9999px; 
            border: 1px solid rgba(255,255,255,0.05);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transform: translateY(0);
            box-shadow: none;
            text-shadow: none; 
            transition: all 0.3s ease;
        }
        
        .caption-animate {
            animation: fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes fadeInUp {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInLeft {
            0% { opacity: 0; transform: translateX(-20px); }
            100% { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes floatUp {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.1; } 
            90% { opacity: 0.1; }
            100% { transform: translateY(-20vh) rotate(360deg); opacity: 0; }
        }

        .avatar-stack-item {
            border: 2px solid #09090b;
            transition: transform 0.2s ease;
        }
        .avatar-stack-item:hover {
            transform: translateY(-2px);
            z-index: 10;
        }

        .frost-effect {
            filter: contrast(1.1) brightness(1.2) sepia(0.2) hue-rotate(190deg) saturate(0.8);
        }
        .frost-overlay {
            background: linear-gradient(135deg, rgba(200, 230, 255, 0.1), transparent);
            mix-blend-mode: overlay;
        }

        #toast-container {
            position: fixed;
            bottom: 24px;
            left: 24px;
            z-index: 5000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .join-toast {
            background: rgba(16, 16, 18, 0.4); /* Made background much more transparent */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 12px 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.5); /* Softened shadow */
            transform: translateX(-50px);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            pointer-events: auto;
            min-width: 220px;
        }

        .join-toast.active {
            transform: translateX(0);
            opacity: 1;
        }
        
        .toast-join { border-left: 3px solid #3b82f6; }
        .toast-leave { border-left: 3px solid #ef4444; }

        .join-toast img {
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="h-screen flex flex-col text-zinc-100 selection:bg-brand-accent selection:text-black">

    <div class="noise-overlay"></div>
    
    <div id="toast-container"></div>

    <div id="loading-screen" class="fixed inset-0 bg-black z-[2000] flex items-center justify-center transition-opacity duration-500">
        <div class="flex flex-col items-center relative">
            <div class="absolute inset-0 bg-brand-accent blur-[40px] opacity-20 rounded-full animate-pulse"></div>
            <div class="w-16 h-16 border-4 border-t-4 border-brand-accent border-t-transparent rounded-full animate-spin mb-4 relative z-10"></div>
            <p class="text-white font-pixel text-2xl tracking-widest relative z-10 animate-pulse">MNVIBES.ORG</p>
        </div>
    </div>

    <div id="global-bg" class="fixed inset-0 z-[-1] overflow-hidden pointer-events-none bg-black">
        <div id="bg-image-container" class="absolute inset-0 z-0"></div>
        <div class="absolute inset-0 bg-gradient-to-b from-black/20 via-black/60 to-[#050505] z-10"></div>
        <div class="absolute inset-0 bg-black/20 z-10"></div> 
        <div class="absolute inset-0 opacity-20 z-10" style="background-image: url('https://www.transparenttextures.com/patterns/stardust.png');"></div>
    </div>

    <nav class="fixed top-0 w-full z-50 h-24 flex items-center justify-between px-6 md:px-12 pointer-events-none bg-gradient-to-b from-black via-black/80 to-transparent backdrop-blur-[2px]">
        <div class="pointer-events-auto flex items-center gap-4 cursor-pointer group relative" onclick="app.routerWithCooldown('home')">
            <div class="relative w-14 h-14 flex items-center justify-center transition-transform duration-300 group-hover:rotate-12 group-hover:scale-110">
                <div class="absolute inset-0 bg-red-600 blur-xl opacity-0 group-hover:opacity-40 transition-opacity duration-300"></div>
                <img src="https://i.ibb.co/27YWBW6M/Picsart-25-12-04-05-19-25-855.png" alt="MongolVibes Logo" class="w-full h-full object-contain relative z-10 drop-shadow-[0_0_15px_rgba(220,38,38,0.5)]">
            </div>
            <div class="flex flex-col relative">
                <span class="font-pixel text-2xl tracking-tighter text-white group-hover:text-red-500 transition-colors drop-shadow-md">MongolVibes</span>
                <span id="splash-text" class="text-[11px] text-yellow-300 font-pixel splash-text hidden md:block leading-none tracking-wide px-1 rounded">Made in Mongolia!</span>
            </div>
        </div>

        <div class="pointer-events-auto hidden md:flex items-center gap-2 bg-zinc-900/40 backdrop-blur-md border border-white/5 p-1.5 rounded-xl shadow-2xl nav-menu hover:border-white/10 transition-colors">
            <div class="nav-highlight" id="nav-highlight"></div>
            <button onclick="app.routerWithCooldown('home', this)" class="nav-btn px-6 py-2.5 rounded-lg font-pixel text-xs font-bold uppercase tracking-wider text-zinc-400 hover:text-white transition-all relative z-10" data-target="home">Overview</button>
            <button onclick="app.routerWithCooldown('community', this)" class="nav-btn px-6 py-2.5 rounded-lg font-pixel text-xs font-bold uppercase tracking-wider text-zinc-400 hover:text-white transition-all relative z-10" data-target="community">Season XI</button>
            <button onclick="app.routerWithCooldown('news', this)" class="nav-btn px-6 py-2.5 rounded-lg font-pixel text-xs font-bold uppercase tracking-wider text-zinc-400 hover:text-white transition-all relative z-10" data-target="news">News</button>
            <button onclick="app.routerWithCooldown('store', this)" class="nav-btn px-6 py-2.5 rounded-lg font-pixel text-xs font-bold uppercase tracking-wider text-zinc-400 hover:text-white transition-all relative z-10" data-target="store">Store</button>
            <button onclick="app.handleVoteClick(this)" class="nav-btn px-6 py-2.5 rounded-lg font-pixel text-xs font-bold uppercase tracking-wider text-brand-accent hover:text-blue-300 transition-all relative z-10 drop-shadow-[0_0_8px_rgba(59,130,246,0.3)]" data-target="vote">Vote</button>
        </div>

        <div class="pointer-events-auto hidden md:flex flex-col items-end">
            <div onclick="app.openIPModal()" class="cursor-pointer bg-zinc-900/50 backdrop-blur-md border border-white/10 hover:border-brand-accent/50 hover:bg-zinc-900/80 transition-all duration-300 px-5 py-2.5 rounded-full flex items-center gap-3 group shadow-lg hover:shadow-brand-accent/10 hover:-translate-y-0.5">
                <div class="flex flex-col items-end leading-none">
                    <span class="text-[9px] text-zinc-500 uppercase font-bold tracking-[0.2em] mb-1 group-hover:text-white transition-colors">Server Status</span>
                    <span id="server-status" class="text-brand-accent font-mono font-bold text-sm tracking-wide">Pinging...</span>
                </div>
                <div class="relative w-3 h-3">
                    <span class="absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75 animate-ping"></span>
                    <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500 shadow-[0_0_10px_#22c55e]" id="status-dot"></span>
                </div>
            </div>
        </div>
    </nav>

    <button onclick="document.querySelector('.mobile-menu').classList.toggle('hidden')" class="md:hidden fixed top-5 right-5 z-50 pointer-events-auto bg-black/80 backdrop-blur border border-white/20 p-3 rounded-lg text-white">
        <i data-feather="menu"></i>
    </button>
    
    <div class="mobile-menu hidden fixed inset-0 bg-black/98 z-40 flex flex-col items-center justify-center gap-8 pointer-events-auto backdrop-blur-xl">
        <button onclick="app.routerWithCooldown('home', this); document.querySelector('.mobile-menu').classList.add('hidden')" class="text-3xl font-pixel hover:text-brand-accent tracking-tighter">Overview</button>
        <button onclick="app.routerWithCooldown('community', this); document.querySelector('.mobile-menu').classList.add('hidden')" class="text-3xl font-pixel hover:text-brand-accent tracking-tighter">Season XI</button>
        <button onclick="app.routerWithCooldown('news', this); document.querySelector('.mobile-menu').classList.add('hidden')" class="text-3xl font-pixel hover:text-brand-accent tracking-tighter">News</button>
        <button onclick="app.routerWithCooldown('store', this); document.querySelector('.mobile-menu').classList.add('hidden')" class="text-3xl font-pixel text-brand-accent tracking-tighter">Store</button>
        <a href="https://minecraft-mp.com/server/322276/vote/" target="_blank" class="text-3xl font-pixel hover:text-brand-accent no-underline tracking-tighter">Vote</a>
        <button onclick="app.openIPModal(); document.querySelector('.mobile-menu').classList.add('hidden')" class="text-sm font-mono text-zinc-500 border border-white/10 px-6 py-3 rounded-full uppercase tracking-widest mt-8">Check Status</button>
    </div>

    <div id="ip-modal" class="modal-overlay" onclick="if(event.target === this) app.closeIPModal()">
        <div class="tilt-card w-full max-w-4xl perspective-container">
            <div class="modal-glass rounded-lg overflow-hidden relative shadow-2xl animate-enter-slide group transform-gpu">
                <div class="bg-black/40 h-8 flex justify-between items-center relative z-20 select-none">
                    <div class="flex items-center gap-3 px-3">
                        <i class="fas fa-terminal text-zinc-500 text-xs"></i>
                        <span class="font-mono text-[10px] text-zinc-400 uppercase tracking-widest">Secure Connection Terminal</span>
                    </div>
                    <div class="flex h-full">
                        <button class="win-btn hover:bg-white/10"><i class="fas fa-minus text-[10px]"></i></button>
                        <button class="win-btn hover:bg-white/10"><i class="far fa-square text-[10px]"></i></button>
                        <button onclick="app.closeIPModal()" class="win-btn close"><i class="fas fa-times text-[12px]"></i></button>
                    </div>
                </div>

                <div class="flex flex-col md:flex-row relative z-10">
                    <div class="md:w-2/5 p-8 bg-black/40 border-b md:border-b-0 md:border-r border-white/5 flex flex-col justify-between relative overflow-hidden">
                        <div class="grid-bg-anim absolute inset-0 opacity-20 pointer-events-none"></div>
                        
                        <div>
                            <div class="flex items-end gap-2 mb-1">
                                <h3 class="text-4xl text-white font-pixel tracking-tighter">MNVIBES</h3>
                                <span class="text-brand-accent font-mono text-xs mb-1">.ORG</span>
                            </div>
                            <div class="flex gap-1 h-8 mb-6 items-end">
                                <div class="w-2 bg-brand-accent signal-bar"></div>
                                <div class="w-2 bg-brand-accent signal-bar"></div>
                                <div class="w-2 bg-brand-accent signal-bar"></div>
                                <div class="w-2 bg-zinc-700 h-2"></div>
                                <span class="ml-2 text-xs font-mono text-brand-accent self-center">EXCELLENT</span>
                            </div>
                        </div>

                        <div class="space-y-4 relative z-10">
                            <div class="bg-zinc-900/40 p-1 rounded border border-white/10 backdrop-blur-sm group hover:border-brand-accent/30 transition-all duration-300 relative overflow-hidden cursor-pointer" onclick="app.copyIPFromModal()">
                                <div class="absolute inset-0 bg-brand-accent/5 translate-x-[-100%] group-hover:translate-x-0 transition-transform duration-500"></div>
                                <div class="p-3 relative z-10">
                                    <div class="text-[10px] text-zinc-500 font-mono uppercase mb-1 flex justify-between items-center">
                                        Server Address
                                        <i class="fas fa-copy text-zinc-600 group-hover:text-brand-accent transition-colors"></i>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <code class="text-white font-mono font-bold tracking-wide group-hover:text-brand-accent transition-colors">mnvibes.org</code>
                                        <span id="copy-feedback-modal" class="text-[10px] text-brand-accent font-bold opacity-0 transition-opacity">COPIED</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-zinc-900/80 p-3 rounded border border-white/10 backdrop-blur-sm">
                                <div class="text-[10px] text-zinc-500 font-mono uppercase mb-1">Bedrock Port</div>
                                <code class="text-white font-mono font-bold tracking-wide">19132</code>
                            </div>
                        </div>
                    </div>

                    <div class="md:w-3/5 p-8 bg-gradient-to-br from-zinc-900/20 to-zinc-900/80">
                        <div class="flex justify-between items-center mb-6">
                            <h4 class="text-sm font-bold text-white uppercase tracking-widest font-pixel">
                                <i class="fas fa-users text-brand-accent mr-2"></i>Live Manifest
                            </h4>
                            <div class="flex items-center gap-2">
                                <button onclick="app.fetchStatus()" class="text-zinc-500 hover:text-white transition-colors group" title="Reload Status">
                                    <i id="reload-icon" class="fas fa-sync-alt text-xs group-hover:rotate-180 transition-transform duration-500"></i>
                                </button>
                                <span class="text-[10px] bg-green-500/10 text-green-400 border border-green-500/20 px-2 py-1 rounded font-mono">ONLINE</span>
                            </div>
                        </div>
                        
                        <div id="player-list-container" class="player-head-grid bg-black/20 p-4 rounded-xl border border-white/5 min-h-[180px] shadow-inner custom-scrollbar">
                            <div class="col-span-full flex flex-col items-center justify-center h-full text-zinc-600 gap-2">
                                <i class="fas fa-circle-notch fa-spin"></i>
                                <span class="text-xs font-mono">Scanning Frequency...</span>
                            </div>
                        </div>
                        
                        <div class="mt-6 flex gap-3">
                            <button onclick="app.copyIPFromModal()" class="btn-glitch flex-1 bg-white text-black py-3 rounded font-pixel text-xs font-bold uppercase tracking-wider hover:bg-zinc-200">
                                Copy IP
                            </button>
                            <a href="minecraft://?addServer=MongolVibes:mnvibes.org:19132" class="btn-glitch flex-1 bg-brand-accent/10 border border-brand-accent/50 text-brand-accent py-3 rounded font-pixel text-xs font-bold uppercase tracking-wider hover:bg-brand-accent hover:text-black flex items-center justify-center gap-2 no-underline">
                                Launch
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="news-modal" class="news-reader-fullscreen">
        <div id="news-reader-bar" class="bg-black/90 h-10 flex justify-between items-center relative z-20 select-none border-b border-white/10 shrink-0 px-6 backdrop-blur-md transition-transform duration-300">
            <div class="flex items-center gap-3">
                <i class="fas fa-newspaper text-brand-accent text-sm"></i>
                <span class="font-mono text-[11px] text-zinc-400 uppercase tracking-widest">MongolVibes Newsletter</span>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-[10px] text-zinc-600 font-mono uppercase hidden sm:block">Press ESC to close</div>
                <button onclick="app.closeNewsModal()" class="win-btn close w-8 h-8 rounded hover:bg-red-500/20 text-zinc-400 hover:text-white transition-all"><i class="fas fa-times text-sm"></i></button>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto custom-scrollbar bg-black/50" id="news-content-area">
        </div>
    </div>

    <div id="discord-modal" class="modal-overlay" onclick="if(event.target === this) app.closeDiscordModal()">
        <div class="tilt-card w-full max-w-md perspective-container">
            <div class="modal-glass rounded-lg overflow-hidden relative shadow-2xl animate-enter-slide group transform-gpu border border-[#5865F2]/30">
                 <div class="bg-[#5865F2]/10 h-8 flex justify-between items-center relative z-20 select-none border-b border-[#5865F2]/20">
                    <div class="flex items-center gap-3 px-3">
                        <i class="fab fa-discord text-[#5865F2] text-xs"></i>
                        <span class="font-mono text-[10px] text-zinc-400 uppercase tracking-widest">Discord Community Hub</span>
                    </div>
                    <div class="flex h-full">
                         <button onclick="app.closeDiscordModal()" class="win-btn close"><i class="fas fa-times text-[12px]"></i></button>
                    </div>
                </div>

                <div class="p-8 relative bg-[#5865F2]/5">
                    <div class="grid-bg-anim absolute inset-0 opacity-10 pointer-events-none"></div>
                    <div class="flex flex-col items-center text-center relative z-10">
                        <div class="w-20 h-20 bg-[#5865F2] rounded-2xl flex items-center justify-center mb-6 shadow-[0_0_30px_rgba(88,101,242,0.4)] tilt-card">
                            <i class="fab fa-discord text-4xl text-white"></i>
                        </div>
                        <h3 class="text-2xl text-white font-pixel mb-2" id="discord-server-name">Loading...</h3>
                        <p class="text-zinc-400 text-xs font-mono mb-6 max-w-xs">Join the community. Get support, report players, and chat with the staff team.</p>
                        <div class="flex items-center gap-4 bg-black/40 px-6 py-3 rounded-lg border border-white/10 mb-8 w-full justify-center">
                            <div class="flex -space-x-3" id="discord-members-preview">
                                <div class="w-8 h-8 rounded-full bg-zinc-800 border-2 border-zinc-900 animate-pulse"></div>
                                <div class="w-8 h-8 rounded-full bg-zinc-800 border-2 border-zinc-900 animate-pulse"></div>
                            </div>
                            <div class="text-left">
                                <div class="text-white font-bold font-pixel text-lg leading-none" id="discord-online-count">---</div>
                                <div class="text-[10px] text-zinc-500 uppercase font-bold tracking-wider">Online Members</div>
                            </div>
                        </div>
                        <a href="https://discord.gg/XKFtYsN7YF" target="_blank" class="btn-glitch w-full bg-[#5865F2] text-white py-4 rounded font-pixel text-sm font-bold uppercase tracking-widest hover:bg-[#4752C4] shadow-[0_0_20px_rgba(88,101,242,0.3)]">
                            Join Server
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="payment-modal" class="modal-overlay" onclick="if(event.target === this) app.closePaymentModal()">
        <div class="tilt-card w-full max-w-3xl animate-enter-slide">
            <div class="modal-glass rounded-lg overflow-hidden shadow-2xl relative border border-zinc-700/50">
                 <div class="bg-black/80 h-8 flex justify-between items-center relative z-20 select-none border-b border-white/5">
                    <div class="flex items-center gap-3 px-3">
                        <i class="fas fa-lock text-brand-hyper text-xs"></i>
                        <span class="font-mono text-[10px] text-zinc-400 uppercase tracking-widest">Secure Transaction Layer</span>
                    </div>
                    <div class="flex h-full">
                         <button onclick="app.closePaymentModal()" class="win-btn close"><i class="fas fa-times text-[12px]"></i></button>
                    </div>
                </div>
                <div class="flex flex-col md:flex-row min-h-[400px]">
                    <div class="md:w-5/12 bg-black relative p-8 flex flex-col justify-between overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-30"></div>
                        <div class="absolute -bottom-10 -right-10 w-40 h-40 bg-brand-hyper blur-[60px] opacity-20 rounded-full"></div>
                        <div class="relative z-10">
                            <div class="w-12 h-12 rounded-full border border-white/20 flex items-center justify-center mb-6 backdrop-blur-md">
                                <i class="fas fa-shopping-bag text-white"></i>
                            </div>
                            <h3 class="text-4xl text-white font-pixel mb-1 tracking-tighter" id="pay-rank-name">RANK</h3>
                            <div id="pay-price-container">
                                <p class="text-brand-accent font-mono text-xl" id="pay-rank-price">0 MNT</p>
                            </div>
                        </div>
                        <div class="relative z-10">
                            <div class="h-px w-full bg-gradient-to-r from-white/20 to-transparent mb-4"></div>
                            <ul id="pay-rank-perks" class="space-y-2 text-xs font-mono text-zinc-400"></ul>
                        </div>
                    </div>
                    <div class="md:w-7/12 p-8 bg-zinc-900/90 relative">
                        <h4 class="text-lg text-white font-pixel mb-6 flex items-center gap-2">
                            <i class="fas fa-university text-zinc-500"></i> Transfer Details
                        </h4>
                        <div class="space-y-4">
                            <div class="p-4 rounded-lg bg-black/40 border border-white/5 hover:border-brand-accent/30 transition-colors group cursor-pointer relative overflow-hidden" onclick="navigator.clipboard.writeText('5303195240')">
                                <div class="absolute inset-0 bg-brand-accent/5 translate-x-[-100%] group-hover:translate-x-0 transition-transform duration-500"></div>
                                <div class="flex justify-between items-center relative z-10">
                                    <div>
                                        <div class="text-[10px] text-zinc-500 uppercase font-bold mb-1">Khan Bank Account</div>
                                        <div class="text-xl font-mono text-white tracking-widest font-bold">5303195240</div>
                                        <div class="text-xs text-zinc-400 mt-1">UCHRAL (MN98000500)</div>
                                    </div>
                                    <i class="fas fa-copy text-zinc-600 group-hover:text-brand-accent transition-colors"></i>
                                </div>
                            </div>
                            
                            <div class="bg-red-500/10 border border-red-500/20 p-4 rounded-lg">
                                <p class="text-xs text-white font-mono leading-relaxed mb-0 font-bold">
                                    <i class="fas fa-exclamation-triangle mr-1 text-red-500"></i> PURCHASE AGREEMENT
                                </p>
                                <p class="text-[10px] text-zinc-300 font-mono mt-2 leading-relaxed">
                                    By completing this transaction, you explicitly confirm that you are over 18 or have parental consent. All sales are <strong class="text-white">FINAL</strong> and <strong class="text-white">NON-REFUNDABLE</strong>. Rank perks are subject to seasonal rebalancing. You must include your correct Minecraft IGN and Discord Username in the bank transaction description. Failure to do so may result in a reversed transaction.
                                </p>
                            </div>

                            <div class="p-4 rounded-lg bg-yellow-500/5 border border-yellow-500/10 flex gap-3">
                                <i class="fas fa-exclamation-circle text-yellow-500 mt-0.5"></i>
                                <p class="text-xs text-yellow-200/80 font-mono leading-relaxed">
                                    Please include your <strong class="text-white">Minecraft Username</strong> in the transaction description. Ranks are applied manually within 24 hours.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="screenshot-modal" class="modal-overlay" onclick="if(event.target === this) app.closeScreenshotModal()">
        <div class="fixed inset-0 bg-black/95 flex items-center justify-center z-1000 p-4 animate-enter-slide">
             <div class="relative max-w-7xl max-h-[90vh] bg-zinc-800/50 backdrop-blur-md rounded-lg border border-white/10 shadow-[0_0_100px_rgba(0,0,0,1)] flex flex-col">
                 <div class="bg-black/60 h-8 flex justify-between items-center relative z-20 select-none border-b border-white/10 px-0 rounded-t-lg">
                    <div class="flex items-center gap-3 px-3">
                        <i class="fas fa-image text-zinc-500 text-xs"></i>
                        <span class="font-mono text-[10px] text-zinc-400 uppercase tracking-widest">Image Viewer</span>
                    </div>
                    <div class="flex h-full">
                         <button onclick="app.closeScreenshotModal()" class="win-btn close rounded-tr-lg"><i class="fas fa-times text-[12px]"></i></button>
                    </div>
                </div>
                <div class="p-1 flex items-center justify-center bg-black">
                    <img id="screenshot-image" src="" alt="Screenshot" class="max-w-full max-h-[80vh] object-contain rounded shadow-lg">
                </div>
            </div>
        </div>
    </div>

    <!-- RECAP POPUP -->
    <div id="recap-popup" class="fixed bottom-6 right-6 z-[9000] hidden translate-y-10 opacity-0 transition-all duration-500 ease-out">
        <div class="bg-zinc-900/90 backdrop-blur-xl border border-brand-accent/20 p-4 rounded-xl shadow-[0_0_30px_rgba(0,0,0,0.5)] flex items-center gap-4 max-w-xs md:max-w-sm relative overflow-hidden group">
            <!-- Decorative shine -->
            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000 pointer-events-none"></div>
            
            <div class="flex-shrink-0 w-10 h-10 bg-brand-accent/10 rounded-lg flex items-center justify-center border border-brand-accent/20 animate-pulse">
                <i class="fas fa-server text-brand-accent"></i>
            </div>
            
            <div class="flex-1 mr-2">
                <h4 class="text-white font-pixel text-xs mb-0.5 tracking-wide text-brand-accent">2025 SERVER RECAP</h4>
                <p class="text-zinc-400 text-[10px] font-mono leading-tight">See how we grew this year. Check the server stats.</p>
            </div>
            
            <div class="flex items-center gap-3 relative z-10">
                <a href="https://www.mnvibes.org/recap" class="bg-brand-accent hover:bg-blue-400 text-black font-bold font-pixel text-[10px] px-3 py-1.5 rounded transition-colors shadow-[0_0_10px_rgba(59,130,246,0.3)]" target="_blank">
                    VIEW
                </a>
                <button onclick="app.closeRecapPopup()" class="text-zinc-500 hover:text-white transition-colors" title="Close">
                    <i class="fas fa-times text-xs"></i>
                </button>
            </div>
        </div>
    </div>

    <main id="app-container" class="flex-1 pt-24 overflow-y-auto overflow-x-hidden scroll-smooth perspective-container relative">
        <div id="content-slot" class="px-6 md:px-12 pb-12 max-w-7xl mx-auto min-h-[80vh] relative z-10"></div>

        <footer class="border-t border-white/5 bg-black/60 py-16 px-6 mt-6 backdrop-blur-xl relative overflow-hidden z-10">
            <div class="absolute inset-0 bg-gradient-to-t from-brand-accent/5 to-transparent pointer-events-none"></div>
            <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-12 text-sm text-zinc-500 relative z-10">
                <div>
                    <div class="flex items-center gap-2 text-white font-bold mb-4 font-pixel tracking-tight">
                        <div class="w-6 h-6">
                            <img src="https://i.ibb.co/27YWBW6M/Picsart-25-12-04-05-19-25-855.png" alt="Logo" class="w-full h-full object-contain grayscale opacity-70 hover:grayscale-0 hover:opacity-100 transition-all">
                        </div>
                        MongolVibes
                    </div>
                    <p class="leading-relaxed font-mono text-xs text-zinc-500 max-w-xs">
                        Crafted with <i class="fas fa-heart text-red-900 mx-1"></i> in Ulaanbaatar. <br>
                        Independent. Community Driven. No Pay-To-Win Trash.
                    </p>
                    <p class="font-mono text-[10px] text-zinc-800 mt-2 opacity-50">Designed and Written by Pekly.</p>
                </div>
                <div>
                    <h5 class="text-white font-bold mb-6 font-pixel text-xs uppercase tracking-[0.2em] text-zinc-400">Links</h5>
                    <ul class="space-y-3 font-mono text-xs">
                        <li><a href="https://support.mnvibes.org" class="hover:text-brand-accent transition-all hover:pl-2">Help Center</a></li>
                        <li><a href="https://support.mnvibes.org/rules" class="hover:text-brand-accent transition-all hover:pl-2">Rules & Guidelines</a></li>
                        <li><a href="https://support.mnvibes.org/appeal" class="hover:text-brand-accent transition-all hover:pl-2">Ban Appeals</a></li>
                    </ul>
                </div>
                <div>
                    <p class="font-mono text-[10px] bg-clip-text text-transparent bg-gradient-to-r from-zinc-500 to-white uppercase tracking-widest font-bold">Est. 2023  Season XI</p>
                    <p class="font-mono text-[10px] text-zinc-700 mt-2">Not affiliated with Mojang AB.</p>
                </div>
            </div>
        </footer>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getFirestore, collection, getDocs, getDoc, doc, orderBy, query, limit } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCBCi0njBqtsHMErMA30uXRuM5-YRFryDo",
            authDomain: "pekly-art-gallery.firebaseapp.com",
            projectId: "pekly-art-gallery",
            storageBucket: "pekly-art-gallery.firebasestorage.app",
            messagingSenderId: "924575560305",
            appId: "1:924575560305:web:06036639eb93f84e5821d0"
        };

        const appFirebase = initializeApp(firebaseConfig);
        const db = getFirestore(appFirebase);

        window.fetchNewsData = async () => {
            try {
                const q = query(collection(db, "news"), orderBy("date", "desc"));
                const querySnapshot = await getDocs(q);
                return querySnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
            } catch (error) {
                console.error("Error getting news:", error);
                return []; 
            }
        };

        window.fetchSingleNews = async (id) => {
            try {
                const docRef = doc(db, "news", id);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    return { id: docSnap.id, ...docSnap.data() };
                }
                return null;
            } catch (error) {
                console.error("Error getting news post:", error);
                return null;
            }
        };
        
        window.fetchRecentPurchases = async () => {
             try {
                 const q = query(collection(db, "recent_supporters"), orderBy("timestamp", "desc"), limit(5));
                 const querySnapshot = await getDocs(q);
                 return querySnapshot.docs.map(doc => doc.data());
             } catch (error) {
                 console.error("Error getting recent supporters:", error);
                 return [];
             }
        };

        window.fetchTopSupporter = async () => {
            try {
                const q = query(collection(db, "top_supporter"), limit(1));
                const querySnapshot = await getDocs(q);
                if (!querySnapshot.empty) {
                    return querySnapshot.docs[0].data();
                }
                return null; 
            } catch (error) {
                console.error("Error getting top supporter:", error);
                return null;
            }
        };
    </script>

    <script>
        const app = {
            state: {
                serverIP: 'mnvibes.org',
                currentPage: null,
                lastActivePage: 'home',
                statusCache: null,
                discordCache: null,
                newsCache: [],
                newsFilter: 'updates', 
                addedPlayerSplash: false,
                adminAvatar: "https://www.gravatar.com/avatar/e4ed8aa7ba70a2e44240adbcfd946d3a?d=200",
                recapTimer: null,
                defaultSeo: {
                    title: "MongolVibes | Survival Redefined",
                    desc: "Join Season XI. Pure Vanilla Survival. Custom terrain, player-driven economy, and a community that feels like home.",
                    image: "https://i.ibb.co/cS7GGFrF/Picsart-26-01-03-14-31-23-675.jpg"
                },
                currentSlide: 0,
                slides: [
                    { img: "https://i.ibb.co/cS7GGFrF/Picsart-26-01-03-14-31-23-675.jpg", alt: "Season XI: Vanilla Survival" },
                    { img: "https://digitality.neocities.org/mongolvibes/seasonxlobby.png", alt: "Community Hub & Lobby" },
                    { img: "https://digitality.neocities.org/mongolvibes/shopseasonx.png", alt: "Custom Item Shop" }
                ],
                slideInterval: null,
                storeItems: {
                    ranks: [
                        {
                            id: 'light_rank',
                            name: 'LIGHT',
                            price: '6,999',
                            priceVal: 6999,
                            originalPrice: '10,000',
                            perks: ['Custom Colored Chat', '5 Sethomes', 'Light Kit', 'Heart Cap +5', 'Weekly Light Keys'],
                            isBestValue: false,
                            theme: 'green',
                            icon: `<path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`
                        },
                        {
                            id: 'hyper_rank',
                            name: 'HYPER',
                            price: '19,999',
                            priceVal: 19999,
                            originalPrice: '25,000',
                            perks: ['Light Rank Perks', 'Unlimited Homes', 'Hyper Kit', '/fly in Lobby', 'Custom Particles', 'Heart Cap +15', 'Weekly Hyper Keys'],
                            isBestValue: true,
                            theme: 'hyper',
                            icon: `<path d="M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z"/>`
                        },
                        {
                            id: 'bypass_rank',
                            name: 'BYPASS',
                            price: '35,000',
                            priceVal: 35000,
                            originalPrice: null,
                            perks: ['Includes Hyper & Light Perks', 'Immune to Player Damage', 'Cannot Deal PVP Damage', 'Heart System Disabled', 'Hidden from Locator Bar'],
                            isBestValue: false,
                            theme: 'bypass',
                            icon: `<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>`
                        }
                    ],
                    consumables: [
                         {
                            id: 'crate_key',
                            name: 'CRATE KEY',
                            price: '2,000 MNT',
                            priceVal: 2000,
                            originalPrice: null,
                            desc: '1x Lifesteal Key',
                            icon: 'fa-key',
                            color: 'yellow'
                        },
                        {
                            id: 'gear_kit',
                            name: 'GEAR KIT',
                            price: '8,000 MNT',
                            priceVal: 8000,
                            originalPrice: '10,000 MNT',
                            desc: 'Fully Maxed Gear Kit',
                            icon: 'fa-shield-alt',
                            color: 'purple'
                        }
                    ]
                }
            },
            
            splashTexts: [
                "Made in Mongolia!", "Thanks!", "Season XI Live!", "Lowkey Chill!", 
                "No P2W!", "Bedrock Ready!", "Since 2023!", "Also try Terraria!", 
                "Mongol Server!", "Use /vote!", "MONGOLVIBES!"
            ],

            initTiltEffect: () => {
                const cards = document.querySelectorAll('.card-indie, .tilt-card');
                cards.forEach(card => {
                    card.addEventListener('mousemove', (e) => {
                        const rect = card.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        const centerX = rect.width / 2;
                        const centerY = rect.height / 2;
                        const rotateX = ((y - centerY) / centerY) * -5;
                        const rotateY = ((x - centerX) / centerX) * 5;
                        card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`;
                    });
                    card.addEventListener('mouseleave', () => {
                        card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)';
                    });
                });
            },
            
            startCarousel: () => {
                if (app.state.slideInterval) clearInterval(app.state.slideInterval);
                // REMOVED app.renderCarousel() from here to fix animation reset bug
                app.state.slideInterval = setInterval(app.nextSlide, 5000); 
            },

            stopCarousel: () => {
                if (app.state.slideInterval) clearInterval(app.state.slideInterval);
            },

            nextSlide: () => {
                app.state.currentSlide = (app.state.currentSlide + 1) % app.state.slides.length;
                app.updateCarousel();
            },

            prevSlide: () => {
                app.state.currentSlide = (app.state.currentSlide - 1 + app.state.slides.length) % app.state.slides.length;
                app.updateCarousel();
            },

            goToSlide: (index) => {
                app.state.currentSlide = index;
                app.updateCarousel(); // Transition happens here
                app.startCarousel();  // Restart timer without re-rendering DOM
            },

            renderCarousel: () => {
                const container = document.getElementById('hero-carousel');
                if (!container) return;
                
                const slidesHtml = app.state.slides.map((slide, index) => `
                    <img src="${slide.img}" 
                         class="carousel-slide ${index === app.state.currentSlide ? 'active' : ''}" 
                         alt="${slide.alt}">
                `).join('');

                const dotsHtml = app.state.slides.map((_, index) => `
                    <div class="carousel-dot ${index === app.state.currentSlide ? 'active' : ''}" 
                         onclick="app.goToSlide(${index})"></div>
                `).join('');
                
                const captionHtml = `<div class="carousel-caption caption-animate">${app.state.slides[app.state.currentSlide].alt}</div>`;

                container.innerHTML = `
                    ${slidesHtml}
                    <!-- Click Zones for Navigation -->
                    <div class="absolute inset-y-0 left-0 w-1/2 z-10 cursor-pointer" onclick="app.prevSlide()"></div>
                    <div class="absolute inset-y-0 right-0 w-1/2 z-10 cursor-pointer" onclick="app.nextSlide()"></div>
                    
                    <div class="carousel-overlay">
                        ${captionHtml}
                    </div>
                    <div class="carousel-dots">
                        ${dotsHtml}
                    </div>
                `;
            },

            updateCarousel: () => {
                const container = document.getElementById('hero-carousel');
                if (!container) return;

                const slides = container.querySelectorAll('.carousel-slide');
                const dots = container.querySelectorAll('.carousel-dot');
                const caption = container.querySelector('.carousel-caption');

                slides.forEach((slide, index) => {
                    if (index === app.state.currentSlide) {
                        slide.classList.add('active');
                    } else {
                        slide.classList.remove('active');
                    }
                });

                dots.forEach((dot, index) => {
                    if (index === app.state.currentSlide) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
                });
                
                if(caption) {
                    // Trigger reflow to restart animation
                    caption.classList.remove('caption-animate');
                    void caption.offsetWidth; 
                    caption.innerText = app.state.slides[app.state.currentSlide].alt;
                    caption.classList.add('caption-animate');
                }
            },
            
            // Background is managed globally now
            startFloatingBg: () => { /* No-op for floating BG in global scope */ },
            stopFloatingBg: () => { /* No-op */ },

            updateSeo: (title, desc, image) => {
                document.title = title;
                const setMeta = (propName, propValue, content) => {
                    let element = document.querySelector(`meta[${propName}="${propValue}"]`);
                    if (!element) {
                        element = document.createElement('meta');
                        element.setAttribute(propName, propValue);
                        document.head.appendChild(element);
                    }
                    element.setAttribute('content', content);
                };
                setMeta('property', 'og:title', title);
                setMeta('property', 'og:description', desc);
                if (image) setMeta('property', 'og:image', image);
                setMeta('property', 'twitter:title', title);
                setMeta('property', 'twitter:description', desc);
                if (image) setMeta('property', 'twitter:image', image);
                setMeta('name', 'description', desc);
            },

            setNewsFilter: (filter) => {
                app.state.newsFilter = filter;
                app.renderNewsPosts(document.getElementById('news-feed-container'), app.state.newsCache);
                
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    if(btn.dataset.filter === filter) btn.classList.add('active');
                    else btn.classList.remove('active');
                });
            },
            
            updateHomePlayerCount: () => {
                const container = document.getElementById('home-player-count-display');
                if (!container || !app.state.statusCache || !app.state.statusCache.online) return;
                
                const players = app.state.statusCache.players.list || [];
                const onlineCount = app.state.statusCache.players.online;
                const headsToShow = Math.min(players.length, 3);
                
                if (headsToShow === 0) {
                     container.innerHTML = `
                        <div class="flex items-center gap-2 mb-3 bg-zinc-900/80 w-fit px-3 py-1.5 rounded-full border border-zinc-700/50 backdrop-blur-sm shadow-lg animate-enter-slide">
                            <span class="relative flex h-2 w-2">
                              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                              <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                            </span>
                            <span class="text-[10px] font-mono font-bold text-zinc-300 tracking-wider">${onlineCount} PLAYERS ONLINE</span>
                        </div>
                     `;
                } else {
                    let headsHtml = '';
                    for(let i=0; i<headsToShow; i++) {
                        headsHtml += `<img src="https://mc-heads.net/avatar/${players[i]}/32" class="w-6 h-6 rounded-full avatar-stack-item -ml-2 first:ml-0 bg-zinc-800" alt="${players[i]}">`;
                    }
                    
                    const remaining = onlineCount - headsToShow;
                    if (remaining > 0 || headsToShow > 0) {
                         headsHtml += `<div class="w-6 h-6 rounded-full avatar-stack-item -ml-2 bg-zinc-800 border border-zinc-700 flex items-center justify-center text-[8px] font-bold text-zinc-400">+${remaining > 0 ? remaining : onlineCount}</div>`;
                    }

                    container.innerHTML = `
                        <div class="flex items-center gap-3 mb-4 animate-enter-slide">
                            <div class="flex items-center pl-2">
                                ${headsHtml}
                            </div>
                            <div class="text-[10px] font-mono font-bold text-zinc-400 tracking-wider">
                                <span class="text-green-400"></span> PLAYING NOW
                            </div>
                        </div>
                    `;
                }
            },
            
            // New Function to handle Global Background Switching
            updateBackground: (pageId) => {
                const container = document.getElementById('bg-image-container');
                if (!container) return;

                // Configuration for per-page backgrounds
                const backgrounds = {
                    'home': 'https://i.imgur.com/WvFn4Cc.png',
                    'community': 'https://i.imgur.com/sAxJ57i.png',
                    'news': 'https://i.imgur.com/sys80bu.png',
                    'store': 'https://i.imgur.com/4WjMtNO.png',
                    'vote': 'https://i.imgur.com/sTldxnJ.png'
                };

                const bgUrl = backgrounds[pageId] || backgrounds['home'];

                // Check if the current active background is already the target one to prevent unnecessary transitions
                const currentActive = container.querySelector('.bg-layer.active');
                if (currentActive && currentActive.dataset.bg === bgUrl) return;

                // Create new background layer
                const newLayer = document.createElement('div');
                newLayer.className = 'bg-layer';
                newLayer.style.backgroundImage = `url('${bgUrl}')`;
                newLayer.dataset.bg = bgUrl;

                // Append to container
                container.appendChild(newLayer);

                // Force reflow to ensure transition plays
                void newLayer.offsetWidth;

                // Activate the new layer (fade in)
                newLayer.classList.add('active');

                // Remove old layers after transition
                const oldLayers = container.querySelectorAll('.bg-layer:not(:last-child)');
                oldLayers.forEach(layer => {
                    layer.classList.remove('active');
                    // Remove from DOM after transition matches CSS time (1.2s)
                    setTimeout(() => {
                        if (layer.parentNode) layer.parentNode.removeChild(layer);
                    }, 1200); 
                });
            },

            templates: {
                home: (animated) => `
                    <div class="${animated ? 'animate-enter-slide' : ''}">
                         <!-- No local BG here, using Global BG -->
                         
                        <div class="grid lg:grid-cols-2 gap-16 items-center py-12 md:py-24 relative z-10">
                            <!-- ... content ... -->
                            <div class="order-2 lg:order-1 relative z-10">
                                <div class="inline-flex items-center gap-2 px-3 py-1 bg-zinc-900/80 border border-zinc-700/50 backdrop-blur-sm text-zinc-300 text-[10px] font-mono font-bold tracking-[0.2em] mb-8 rounded-full shadow-lg">
                                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                    JAVA & BEDROCK COMPATIBLE
                                </div>
                                
                                <h1 class="text-6xl md:text-8xl leading-[0.9] text-white mb-8 tracking-tighter drop-shadow-2xl title-glow">
                                    SURVIVAL<br>
                                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-accent to-blue-200">REDEFINED</span>
                                </h1>
                                <p class="text-lg text-zinc-400 leading-relaxed max-w-lg mb-12 font-mono border-l-2 border-brand-accent/50 pl-6 relative">
                                    Experience the best Mongolian Minecraft server. Custom terrain, player-driven economy, and a community that feels like home.
                                </p>
                                
                                <div id="home-player-count-display">
                                    <div class="h-6 w-32 bg-zinc-800/50 rounded animate-pulse mb-4"></div>
                                </div>

                                <div class="flex flex-col sm:flex-row gap-4">
                                    <button onclick="app.openIPModal()" class="btn-glitch bg-white text-black px-8 py-4 rounded font-pixel text-sm font-bold tracking-widest hover:bg-zinc-200 shadow-[0_0_20px_rgba(255,255,255,0.3)]">
                                        START PLAYING
                                    </button>
                                    <button onclick="app.openDiscordModal()" class="btn-glitch bg-[#5865F2] text-white px-8 py-4 rounded font-pixel text-sm font-bold tracking-widest flex items-center justify-center gap-3 shadow-[0_0_20px_rgba(88,101,242,0.3)]">
                                        <i class="fab fa-discord"></i> DISCORD
                                    </button>
                                </div>
                            </div>
                            <div class="order-1 lg:order-2 flex justify-center lg:justify-end relative group perspective-container">
                                <div class="absolute -inset-10 bg-brand-accent/20 blur-[80px] opacity-40 animate-pulse"></div>
                                <div class="relative w-full max-w-xl aspect-video bg-black shadow-2xl transform transition-transform duration-700 hover:rotate-1 hover:scale-105 tilt-card overflow-hidden hero-shape-custom">
                                    <div id="hero-carousel" class="carousel-container">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-24 relative z-10">
                            <div class="flex items-end justify-between border-b border-white/5 pb-4 mb-12">
                                <h2 class="text-3xl text-white font-pixel tracking-tighter">SERVER FEATURES</h2>
                                <span class="text-zinc-600 font-mono text-[10px] uppercase tracking-widest">Sys.Ver 1.21.11</span>
                            </div>
                            <div class="grid md:grid-cols-3 gap-8">
                                <div class="card-indie p-8 rounded-xl bg-zinc-900/40 border border-white/5 hover:border-brand-accent/30 transition-all hover-lift group tilt-card backdrop-blur-sm">
                                    <div class="w-14 h-14 bg-zinc-800/50 rounded-lg flex items-center justify-center mb-6 group-hover:bg-brand-accent/20 transition-colors">
                                        <i class="fas fa-gamepad text-3xl text-brand-accent group-hover:scale-110 transition-transform"></i>
                                    </div>
                                    <h3 class="text-xl text-white mb-3 font-pixel">CUSTOM MODES</h3>
                                    <p class="text-zinc-400 text-sm font-mono leading-relaxed">
                                        Tailored gameplay experiences ranging from hardcore survival to relaxed creative plots.
                                    </p>
                                </div>
                                <div class="card-indie p-8 rounded-xl bg-zinc-900/40 border border-white/5 hover:border-pink-500/30 transition-all hover-lift group tilt-card backdrop-blur-sm">
                                    <div class="w-14 h-14 bg-zinc-800/50 rounded-lg flex items-center justify-center mb-6 group-hover:bg-pink-500/20 transition-colors">
                                        <i class="fas fa-users text-3xl text-pink-500 group-hover:scale-110 transition-transform"></i>
                                    </div>
                                    <h3 class="text-xl text-white mb-3 font-pixel">COMMUNITY</h3>
                                    <p class="text-zinc-400 text-sm font-mono leading-relaxed">
                                        Active staff, regular events, and a toxicity-free environment enforced by custom bots.
                                    </p>
                                </div>
                                <div class="card-indie p-8 rounded-xl bg-zinc-900/40 border border-white/5 hover:border-blue-500/30 transition-all hover-lift group tilt-card backdrop-blur-sm">
                                    <div class="w-14 h-14 bg-zinc-800/50 rounded-lg flex items-center justify-center mb-6 group-hover:bg-blue-500/20 transition-colors">
                                        <i class="fas fa-server text-3xl text-blue-500 group-hover:scale-110 transition-transform"></i>
                                    </div>
                                    <h3 class="text-xl text-white mb-3 font-pixel">PERFORMANCE</h3>
                                    <p class="text-zinc-400 text-sm font-mono leading-relaxed">
                                        Hosted on enterprise hardware with 99.9% uptime and optimized forks for lag-free play.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                
                community: (animated) => `
                    <div class="${animated ? 'animate-enter-slide' : ''} max-w-7xl mx-auto">
                        <!-- Key Art Hero with Season XI Branding -->
                        <div class="relative h-[400px] md:h-[500px] w-full rounded-3xl overflow-hidden mb-16 group xi-card-border shadow-2xl">
                            <!-- Using provided Picart image for new visual identity -->
                            <div class="absolute inset-0 bg-[url('https://i.imgur.com/Kcotrk8.png')] bg-cover bg-center transition-transform duration-[3s] group-hover:scale-105 backdrop-blur-sm"></div>
                            <div class="absolute inset-0 bg-gradient-to-t from-[#0c0a09] via-black/30 to-transparent"></div>
                            
                            <div class="absolute bottom-0 left-0 w-full p-8 md:p-16 flex flex-col items-center text-center z-10">
                                <div class="inline-flex items-center gap-2 px-4 py-1.5 bg-black/60 backdrop-blur-md border border-orange-500/50 rounded-full font-mono text-[10px] font-bold tracking-[0.2em] mb-6 shadow-[0_0_20px_rgba(249,115,22,0.3)] hover:scale-105 transition-transform cursor-crosshair text-orange-400">
                                    <span class="w-1.5 h-1.5 bg-orange-500 rounded-full animate-pulse"></span>
                                    VANILLA SURVIVAL
                                </div>
                                <h1 class="text-7xl md:text-9xl text-white font-pixel tracking-tighter leading-none mb-4 drop-shadow-2xl xi-glow-text">
                                    SEASON <span class="xi-gradient-text relative inline-block hover:animate-pulse">XI
                                        <span class="absolute -inset-4 bg-orange-500 blur-[60px] opacity-20 animate-pulse pointer-events-none"></span>
                                    </span>
                                </h1>
                                <p class="text-lg md:text-xl text-zinc-300 font-mono max-w-2xl drop-shadow-md border-t border-orange-500/30 pt-6 mt-2">
                                    A fresh start. A new horizon. The true survival experience returns.
                                </p>
                            </div>
                        </div>

                        <!-- 2-Column Grid (Structure preserved, content updated for XI) -->
                        <div class="grid md:grid-cols-2 gap-6 mb-20">
                            <!-- Left: Vanilla Core Focus -->
                            <div class="bg-zinc-900/20 backdrop-blur-sm xi-card-border p-1 rounded-2xl hover:border-orange-500/50 transition-all duration-300 group tilt-card">
                                <div class="bg-black/50 h-full rounded-xl p-8 md:p-10 relative overflow-hidden">
                                    <div class="absolute top-0 right-0 p-32 bg-orange-600/10 blur-[80px] rounded-full pointer-events-none group-hover:bg-orange-600/20 transition-colors"></div>
                                    
                                    <div class="flex items-center justify-between mb-8">
                                        <h3 class="text-2xl text-white font-pixel tracking-tight">PURE VANILLA</h3>
                                        <i class="fas fa-leaf text-2xl text-orange-500 group-hover:scale-110 transition-transform"></i>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 gap-4 font-mono text-sm relative z-10">
                                        <p class="text-zinc-400 leading-relaxed mb-4">
                                            We are stripping back the complexity. No over-complicated plugins, no pay-to-win advantages. Just you, the world, and the community.
                                        </p>
                                        
                                        <div class="flex items-center gap-4 p-4 bg-zinc-900/50 rounded-lg border border-white/5 hover:bg-zinc-800/50 transition-colors">
                                            <div class="w-10 h-10 rounded bg-orange-900/20 border border-orange-500/20 flex items-center justify-center text-orange-500 text-lg font-bold"><i class="fas fa-cube"></i></div>
                                            <div>
                                                <div class="text-white font-bold text-xs uppercase tracking-wider mb-0.5">Classic Gameplay</div>
                                                <div class="text-zinc-500 text-[10px]">1.21.11 Generation & Mechanics</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-4 p-4 bg-zinc-900/50 rounded-lg border border-white/5 hover:bg-zinc-800/50 transition-colors">
                                            <div class="w-10 h-10 rounded bg-yellow-900/20 border border-yellow-500/20 flex items-center justify-center text-yellow-500 text-lg font-bold"><i class="fas fa-handshake"></i></div>
                                            <div>
                                                <div class="text-white font-bold text-xs uppercase tracking-wider mb-0.5">Economy Reset</div>
                                                <div class="text-zinc-500 text-[10px]">Player-driven trading only</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right: Roadmap & Teasers (KitBox, BetterMC, Event Servers) -->
                            <div class="bg-zinc-900/20 backdrop-blur-sm xi-card-border p-1 rounded-2xl hover:border-blue-500/50 transition-all duration-300 group tilt-card">
                                <div class="bg-black/50 h-full rounded-xl p-8 md:p-10 relative overflow-hidden">
                                    <div class="absolute top-0 right-0 p-32 bg-blue-600/10 blur-[80px] rounded-full pointer-events-none group-hover:bg-blue-600/20 transition-colors"></div>

                                    <div class="flex items-center justify-between mb-8">
                                        <h3 class="text-2xl text-white font-pixel tracking-tight">EXPANSIONS</h3>
                                        <i class="fas fa-layer-group text-2xl text-blue-400 group-hover:scale-110 transition-transform"></i>
                                    </div>

                                    <p class="font-mono text-xs text-zinc-500 uppercase tracking-widest mb-4">Coming Soon to Season XI</p>

                                    <div class="space-y-3 relative z-10">
                                        <!-- Teaser 1 -->
                                        <div class="bg-zinc-900/40 border border-white/5 p-4 rounded-lg hover:bg-zinc-900/60 transition-colors group/item">
                                            <div class="flex justify-between items-center mb-1">
                                                <h4 class="text-white font-bold text-sm tracking-wide group-hover/item:text-blue-400 transition-colors">KITBOX</h4>
                                                <span class="text-[9px] bg-blue-500/10 text-blue-400 px-2 py-0.5 rounded border border-blue-500/20">PVP MODE</span>
                                            </div>
                                            <p class="text-zinc-500 text-[10px] font-mono">Fast-paced arena combat with custom loadouts.</p>
                                        </div>

                                        <!-- Teaser 2 -->
                                        <div class="bg-zinc-900/40 border border-white/5 p-4 rounded-lg hover:bg-zinc-900/60 transition-colors group/item">
                                            <div class="flex justify-between items-center mb-1">
                                                <h4 class="text-white font-bold text-sm tracking-wide group-hover/item:text-purple-400 transition-colors">BETTERMC</h4>
                                                <span class="text-[9px] bg-purple-500/10 text-purple-400 px-2 py-0.5 rounded border border-purple-500/20">RPG</span>
                                            </div>
                                            <p class="text-zinc-500 text-[10px] font-mono">Enhanced survival with new mobs and structures.</p>
                                        </div>

                                        <!-- Teaser 3 -->
                                        <div class="bg-zinc-900/40 border border-white/5 p-4 rounded-lg hover:bg-zinc-900/60 transition-colors group/item">
                                            <div class="flex justify-between items-center mb-1">
                                                <h4 class="text-white font-bold text-sm tracking-wide group-hover/item:text-yellow-400 transition-colors">EVENT SERVERS</h4>
                                                <span class="text-[9px] bg-yellow-500/10 text-yellow-400 px-2 py-0.5 rounded border border-yellow-500/20">LIMITED</span>
                                            </div>
                                            <p class="text-zinc-500 text-[10px] font-mono">Weekly hosted minigames and tournaments.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Gallery (Structure Preserved) -->
                        <div class="mb-20">
                            <div class="flex items-center justify-between mb-8 px-2">
                                <div class="flex items-center gap-3">
                                    <div class="w-1 h-6 bg-orange-500 rounded-full"></div>
                                    <h2 class="text-2xl text-white font-pixel tracking-tight">MEDIA GALLERY</h2>
                                </div>
                                <span class="text-[10px] font-mono text-zinc-600 uppercase tracking-widest">Season XI Preview</span>
                            </div>
                            
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                ${[
                                    'seasonxlobby.png',
                                    'season9lobby.png', 
                                    'shopseasonx.png',
                                    'Lifestealseasonx.jpg'
                                ].map((img, i) => `
                                    <div class="aspect-square bg-zinc-900 rounded-xl overflow-hidden xi-card-border relative group cursor-pointer" 
                                         onclick="app.openScreenshotModal('https://digitality.neocities.org/mongolvibes/${img}')">
                                        <img src="https://digitality.neocities.org/mongolvibes/${img}" 
                                             class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-60 group-hover:opacity-100" 
                                             onerror="this.src='https://placehold.co/400x400/18181b/white?text=Img+${i+1}'">
                                        <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors"></div>
                                        <div class="absolute bottom-3 left-3 bg-black/60 backdrop-blur px-2 py-1 rounded text-[9px] font-mono text-white opacity-0 group-hover:opacity-100 transition-opacity transform translate-y-2 group-hover:translate-y-0 duration-300 border border-white/10">
                                            VIEW
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="flex justify-center">
                            <div class="max-w-2xl text-center">
                                <i class="fas fa-quote-left text-zinc-700 text-xl mb-4"></i>
                                <p class="text-zinc-400 font-mono text-xs leading-relaxed italic">
                                    Season XI represents a new era for MongolVibes. We are committed to a high-quality, vanilla-focused experience that respects your time and effort.
                                </p>
                            </div>
                        </div>
                    </div>
                `,
                
                news: (animated) => `
                    <div class="max-w-7xl mx-auto pt-8 ${animated ? 'animate-enter-slide' : ''}">
                         <div class="flex items-center justify-between mb-8">
                            <h2 class="text-4xl text-white font-pixel tracking-tighter">NEWS FEED</h2>
                             <div class="flex gap-6 font-mono text-sm tracking-wide">
                                <button onclick="app.setNewsFilter('updates')" class="tab-btn ${app.state.newsFilter === 'updates' ? 'active' : ''}" data-filter="updates">UPDATES</button>
                                <button onclick="app.setNewsFilter('events')" class="tab-btn ${app.state.newsFilter === 'events' ? 'active' : ''}" data-filter="events">EVENTS</button>
                             </div>
                         </div>
                         <div id="news-feed-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                             <div class="flex col-span-full flex-col items-center justify-center py-12 text-zinc-500">
                                <i class="fas fa-circle-notch fa-spin text-2xl mb-4"></i>
                                <p class="font-mono text-xs">Fetching transmission...</p>
                             </div>
                         </div>
                    </div>
                `,

                store: (animated) => `
                    <div class="pb-6">
                        <div class="flex flex-col items-center mb-20 pt-12 animate-enter-slide">
                            <h2 class="text-6xl md:text-8xl text-white mb-6 text-center font-pixel tracking-tighter drop-shadow-xl">ITEM SHOP</h2>
                            <p class="text-zinc-400 text-center max-w-xl font-mono text-sm">
                                Support the server directly. All proceeds go towards high-performance hosting costs.
                            </p>
                        </div>

                        <div class="flex flex-col lg:flex-row gap-12 max-w-7xl mx-auto mb-16">
                            <div class="flex-1">
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                    ${app.state.storeItems.ranks.map(rank => {
                                        const isHyper = rank.theme === 'hyper';
                                        const isBypass = rank.theme === 'bypass';
                                        
                                        let borderColor = 'border-white/10';
                                        if (isHyper) borderColor = 'border-brand-hyper/30';
                                        if (isBypass) borderColor = 'border-brand-bypass/30';

                                        let titleColor = 'text-green-400 group-hover:text-green-300';
                                        if (isHyper) titleColor = 'text-brand-hyper group-hover:text-pink-400';
                                        if (isBypass) titleColor = 'text-brand-bypass group-hover:text-red-400';

                                        let btnBg = 'group-hover:bg-green-600 group-hover:border-green-500 btn-glow-green';
                                        if (isHyper) btnBg = 'group-hover:bg-brand-hyper group-hover:border-pink-500 btn-glow-pink';
                                        if (isBypass) btnBg = 'group-hover:bg-brand-bypass group-hover:border-red-500 btn-glow-red';

                                        let iconColor = 'text-zinc-700 group-hover:text-green-500';
                                        if (isHyper) iconColor = 'text-brand-hyper group-hover:text-pink-400';
                                        if (isBypass) iconColor = 'text-brand-bypass group-hover:text-red-400';

                                        const fillType = (isHyper || isBypass) ? 'fill="currentColor"' : 'fill="none"';
                                        
                                        const perksHtml = rank.perks.map(p => {
                                            let dotColor = 'bg-green-500';
                                            if (isHyper) dotColor = 'bg-brand-hyper shadow-[0_0_5px_#db2777]';
                                            if (isBypass) dotColor = 'bg-brand-bypass shadow-[0_0_5px_#ef4444]';
                                            return `<div class="flex items-center gap-3"><div class="w-1.5 h-1.5 ${dotColor} rounded-full"></div> ${p}</div>`;
                                        }).join('');

                                        let priceDisplay = rank.price;
                                        if (rank.originalPrice) {
                                            priceDisplay = `<span class="line-through text-zinc-500 text-xs mr-2">${rank.originalPrice}</span>${rank.price}`;
                                        }

                                        let bgPattern = 'black-scales';
                                        if (isHyper) bgPattern = 'carbon-fibre';
                                        if (isBypass) bgPattern = 'diagonal-stripes'; 

                                        return `
                                        <div class="card-indie p-6 rounded-2xl bg-black group cursor-pointer relative overflow-hidden tilt-card hover-lift border ${borderColor} ${isHyper ? 'shadow-[0_0_30px_rgba(219,39,119,0.1)]' : ''} ${isBypass ? 'shadow-[0_0_30px_rgba(239,68,68,0.1)]' : ''}" 
                                             onclick="app.openPaymentModal('${rank.name} Rank', '${rank.price}', ['${rank.perks.join("','")}'], '${rank.originalPrice || ''}')">
                                            
                                            <div class="absolute -right-6 -top-6 opacity-10 transform rotate-12 scale-150 pointer-events-none transition-transform group-hover:scale-[1.75] duration-700 ${isBypass ? 'text-red-500' : (isHyper ? 'text-pink-500' : 'text-green-500')}">
                                                <svg width="180" height="180" viewBox="0 0 24 24" ${fillType} xmlns="http://www.w3.org/2000/svg">
                                                    ${rank.icon}
                                                </svg>
                                            </div>

                                            <div class="absolute inset-0 opacity-${isHyper || isBypass ? '30' : '40'} bg-cover bg-center transition-transform duration-700 group-hover:scale-110" style="background-image: url('https://www.transparenttextures.com/patterns/${bgPattern}.png');"></div>
                                            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/80 to-transparent"></div>
                                            
                                            ${isHyper ? '<div class="absolute top-0 right-0 w-32 h-32 bg-brand-hyper blur-[50px] opacity-20 group-hover:opacity-40 transition-opacity"></div>' : ''}
                                            ${isBypass ? '<div class="absolute top-0 right-0 w-32 h-32 bg-brand-bypass blur-[50px] opacity-20 group-hover:opacity-40 transition-opacity"></div>' : ''}
                                            
                                            ${rank.isBestValue ? `
                                            <div class="absolute top-4 right-4 z-20">
                                                <div class="bg-brand-hyper text-white text-[10px] font-bold px-3 py-1 font-mono uppercase rounded-full shadow-[0_0_15px_rgba(219,39,119,0.5)] border border-pink-400 tracking-wider">
                                                    Best Value
                                                </div>
                                            </div>` : ''}

                                            <div class="relative z-10 flex flex-col h-full justify-between">
                                                <div class="flex justify-between items-start mb-6 mt-2">
                                                    <div>
                                                        <h3 class="text-3xl ${titleColor} font-pixel tracking-tight transition-colors">${rank.name}</h3>
                                                        ${isBypass ? '<p class="text-[10px] text-zinc-600 font-mono italic mt-1 leading-tight">Designed for peaceful gameplay. Not Pay-to-Win.</p>' : ''}
                                                        <span class="text-[10px] font-mono text-zinc-500 uppercase tracking-widest border border-zinc-800 px-2 py-1 rounded bg-black/50 mt-2 inline-block">Lifetime Rank</span>
                                                    </div>
                                                </div>
                                                <div class="space-y-3 mb-8 font-mono text-sm text-zinc-300">
                                                    ${perksHtml}
                                                </div>
                                                <div class="btn-glitch w-full bg-zinc-800/80 backdrop-blur border border-zinc-700 text-white text-center py-4 rounded-lg font-pixel text-sm ${btnBg} transition-all">
                                                    ${priceDisplay}
                                                </div>
                                            </div>
                                        </div>
                                        `;
                                    }).join('')}
                                </div>
                                
                                <div class="flex flex-wrap justify-center gap-6 mt-12">
                                    ${app.state.storeItems.consumables.map(item => {
                                        const hoverColor = item.color === 'yellow' ? 'hover:border-yellow-500/50 group-hover:border-yellow-500 text-yellow-500 group-hover:text-yellow-500' : 'hover:border-purple-500/50 group-hover:border-purple-500 text-purple-500 group-hover:text-purple-500';
                                        
                                        let priceDisplay = item.price;
                                        if (item.originalPrice) {
                                            priceDisplay = `<span class="line-through text-zinc-600 mr-1">${item.originalPrice}</span>${item.price}`;
                                        }

                                        return `
                                        <div class="group bg-zinc-900/50 backdrop-blur border border-zinc-800 p-6 rounded-xl cursor-pointer transition-all w-48 text-center hover:-translate-y-2 duration-300 ${item.color === 'yellow' ? 'hover:border-yellow-500/50 btn-glow-yellow shadow-lg shadow-transparent hover:shadow-yellow-500/20' : 'hover:border-purple-500/50 btn-glow-purple shadow-lg shadow-transparent hover:shadow-purple-500/20'}" 
                                             onclick="app.openPaymentModal('${item.name}', '${item.price}', ['${item.desc}'], '${item.originalPrice || ''}')">
                                            <div class="w-12 h-12 bg-black rounded-full flex items-center justify-center mx-auto mb-4 border border-zinc-800 transition-colors ${item.color === 'yellow' ? 'group-hover:border-yellow-500' : 'group-hover:border-purple-500'}">
                                                <i class="fas ${item.icon} text-xl ${item.color === 'yellow' ? 'text-yellow-500' : 'text-purple-500'}"></i>
                                            </div>
                                            <div class="font-pixel text-sm text-white mb-1">${item.name}</div>
                                            <div class="text-[10px] text-zinc-500 font-mono transition-colors ${item.color === 'yellow' ? 'group-hover:text-yellow-500' : 'group-hover:text-purple-500'}">${priceDisplay}</div>
                                        </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                            
                            <div class="lg:w-80 shrink-0 space-y-8">
                                <div class="bg-black/40 border border-white/5 p-6 rounded-xl">
                                    <h4 class="text-white font-pixel mb-4 text-sm border-b border-white/10 pb-2">Recent Supporters</h4>
                                    <div id="recent-purchases-list" class="space-y-4">
                                         <div class="animate-pulse flex gap-3">
                                            <div class="w-8 h-8 rounded bg-zinc-800"></div>
                                            <div class="flex-1 bg-zinc-800 h-8 rounded"></div>
                                         </div>
                                    </div>
                                </div>
                                <div id="top-supporter-card" class="bg-gradient-to-br from-yellow-900/20 to-black border border-yellow-500/20 p-6 rounded-xl relative overflow-hidden transition-all duration-500">
                                    <div class="absolute -top-4 -right-4 text-yellow-500/10 text-6xl">
                                        <i class="fas fa-crown"></i>
                                    </div>
                                    <h4 class="text-yellow-500 font-pixel mb-1 text-sm">Top Supporter</h4>
                                    <div class="flex items-center gap-3 mt-4 animate-pulse">
                                        <div class="w-12 h-12 rounded bg-zinc-800"></div>
                                        <div class="space-y-2">
                                            <div class="w-20 h-4 bg-zinc-800 rounded"></div>
                                            <div class="w-12 h-3 bg-zinc-800 rounded"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8 border-t border-white/5 pt-8 pb-4 text-center max-w-3xl mx-auto px-6 mb-8">
                            <h5 class="text-white font-bold uppercase tracking-widest text-[10px] mb-3">
                                <i class="fas fa-balance-scale mr-1"></i> Terms of Transaction
                            </h5>
                            <p class="text-white text-[10px] font-mono leading-relaxed opacity-90 max-w-2xl mx-auto">
                                BY COMPLETING ANY PURCHASE ON THIS STORE, YOU EXPLICITLY AGREE TO THE FOLLOWING: YOU ARE AT LEAST 18 YEARS OF AGE OR HAVE OBTAINED PARENTAL CONSENT. ALL SALES ARE FINAL AND NON-REFUNDABLE UNDER ANY CIRCUMSTANCES. RANK FEATURES AND PERKS ARE SUBJECT TO ADJUSTMENT FOR GAMEPLAY BALANCE. YOU MUST INCLUDE YOUR CORRECT MINECRAFT IGN AND DISCORD USERNAME IN THE TRANSACTION DESCRIPTION TO RECEIVE YOUR ITEMS. FAILURE TO DO SO MAY RESULT IN A VOIDED TRANSACTION.
                            </p>
                        </div>

                        <div class="max-w-4xl mx-auto bg-black/40 border border-white/5 rounded-2xl overflow-hidden flex flex-col md:flex-row">
                            <div class="md:w-1/3 bg-purple-900/20 p-8 flex flex-col justify-center items-center text-center border-r border-white/5 relative">
                                <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')] opacity-10"></div>
                                <i class="fab fa-youtube text-6xl text-red-500 mb-4 drop-shadow-[0_0_10px_rgba(239,68,68,0.5)]"></i>
                                <h3 class="text-2xl text-white font-pixel">MEDIA RANK</h3>
                            </div>
                            <div class="md:w-2/3 p-8">
                                <h4 class="text-xl text-white font-bold mb-4 font-pixel">CONTENT CREATOR PROGRAM</h4>
                                <p class="text-zinc-400 text-sm font-mono mb-6 leading-relaxed">
                                    Create content for MongolVibes and get rewarded. We look for consistency, quality, and engagement over raw numbers.
                                </p>
                                <div class="grid grid-cols-2 gap-4 mb-6">
                                    <div class="bg-zinc-900/50 p-3 rounded border border-white/5 text-center">
                                        <div class="text-white font-bold text-lg">200+</div>
                                        <div class="text-[10px] text-zinc-500 uppercase">Subscribers</div>
                                    </div>
                                    <div class="bg-zinc-900/50 p-3 rounded border border-white/5 text-center">
                                        <div class="text-white font-bold text-lg">500+</div>
                                        <div class="text-[10px] text-zinc-500 uppercase">Avg Viewers</div>
                                    </div>
                                </div>
                                <p class="text-xs text-zinc-500 mb-4">
                                    Perks include priority support access and rank benefits equivalent to the server's highest tier.
                                </p>
                                <a href="https://discord.com/users/pekuly" target="_blank" class="inline-flex items-center gap-2 text-brand-accent hover:text-white transition-colors font-mono text-xs uppercase tracking-widest font-bold">
                                    <i class="fab fa-discord"></i> PM @pekuly on Discord
                                </a>
                            </div>
                        </div>

                    </div>
                `
            },

            routerWithCooldown: (pageId, element) => {
                if (pageId === 'vote') return; 
                app.closeNewsModal();

                if (app.state.currentPage === pageId) return;
                
                app.state.lastActivePage = pageId;
                window.location.hash = pageId;

                const container = document.getElementById('content-slot');
                container.style.opacity = '0';
                container.style.transform = 'scale(0.98)';
                
                app.updateBackground(pageId); 

                if (app.state.currentPage === 'home') {
                    app.stopCarousel();
                }

                if (app.state.currentPage === 'home' && pageId !== 'home') {
                    app.stopFloatingBg();
                }
                
                setTimeout(() => {
                    app.router(pageId);
                    container.style.transition = 'all 0.4s ease';
                    container.style.opacity = '1';
                    container.style.transform = 'scale(1)';
                    app.initTiltEffect(); 
                }, 200);
                
                if (element) {
                    app.updateNavHighlight(element);
                } else {
                    const btn = document.querySelector(`button[data-target="${pageId}"]`);
                    if(btn) app.updateNavHighlight(btn);
                }
            },

            updateNavHighlight: (element) => {
                const highlight = document.getElementById('nav-highlight');
                if (!highlight || !element) return;
                highlight.style.width = `${element.offsetWidth}px`;
                highlight.style.left = `${element.offsetLeft}px`;
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    const isTarget = btn === element || (btn.dataset.target === element.dataset.target && element.dataset.target !== 'vote');
                    if(isTarget) {
                        btn.classList.remove('text-zinc-400');
                        btn.classList.add('text-white');
                    } else if (btn.dataset.target !== 'vote') {
                        btn.classList.add('text-zinc-400');
                        btn.classList.remove('text-white');
                    }
                });
            },

            handleVoteClick: (element) => {
                const currentActiveButton = document.querySelector(`button[data-target="${app.state.lastActivePage}"]`);
                app.updateNavHighlight(element);
                setTimeout(() => {
                    window.open('https://minecraft-mp.com/server/322276/vote/', '_blank');
                }, 200);
                setTimeout(() => {
                    if (currentActiveButton) {
                        app.updateNavHighlight(currentActiveButton);
                    } else {
                        app.updateNavHighlight(document.querySelector('[data-target="home"]'));
                    }
                }, 600);
            },

            router: (pageId) => {
                const container = document.getElementById('content-slot');
                app.state.currentPage = pageId;
                
                let pageTitle = app.state.defaultSeo.title;
                if(pageId === 'community') pageTitle = "MongolVibes | Season XI";
                if(pageId === 'store') pageTitle = "MongolVibes | Item Shop";
                if(pageId === 'news') pageTitle = "MongolVibes | News Feed";

                if (pageId.startsWith('news/')) {
                    const newsId = pageId.split('/')[1];
                    container.innerHTML = app.templates['news'](true);
                    app.loadNewsFeed().then(() => {
                        app.openNewsModal(newsId);
                    });
                    document.getElementById('app-container').scrollTo(0, 0);
                    return;
                }

                app.updateSeo(pageTitle, app.state.defaultSeo.desc, app.state.defaultSeo.image);

                if (app.templates[pageId]) {
                    container.innerHTML = app.templates[pageId](true);
                    feather.replace();
                    document.getElementById('app-container').scrollTo(0, 0);

                    if (pageId === 'home') {
                        app.renderCarousel(); // Render ONCE when entering home
                        app.startCarousel();  // Start timer
                        app.startFloatingBg();
                        app.updateHomePlayerCount(); 
                    }
                    if (pageId === 'news') {
                        app.loadNewsFeed();
                    }
                    if (pageId === 'store') {
                        app.loadStoreData();
                    }
                }
            },
            
            loadStoreData: async () => {
                const list = document.getElementById('recent-purchases-list');
                const topCard = document.getElementById('top-supporter-card');
                
                if(list && window.fetchRecentPurchases) {
                    const purchases = await window.fetchRecentPurchases();
                    
                    if(purchases.length === 0) {
                        list.innerHTML = `<div class="text-zinc-500 text-xs text-center font-mono">No recent transactions</div>`;
                    } else {
                        list.innerHTML = purchases.map(p => `
                            <div class="flex items-center gap-3 p-2 rounded hover:bg-white/5 transition-colors animate-enter-slide">
                                <img src="https://mc-heads.net/avatar/${p.avatar || 'Steve'}/32" class="w-8 h-8 rounded bg-zinc-900 border border-white/10">
                                <div class="flex-1 min-w-0">
                                    <div class="text-white font-bold text-xs truncate font-mono">${p.name || 'Unknown'}</div>
                                    <div class="text-[10px] text-zinc-500 truncate">Bought ${p.item || 'Item'}</div>
                                </div>
                            </div>
                        `).join('');
                    }
                }

                if(topCard && window.fetchTopSupporter) {
                    const topData = await window.fetchTopSupporter();
                    
                    if (topData) {
                        topCard.innerHTML = `
                            <div class="absolute -top-4 -right-4 text-yellow-500/10 text-6xl">
                                <i class="fas fa-crown"></i>
                            </div>
                            <h4 class="text-yellow-500 font-pixel mb-1 text-sm">Top Supporter</h4>
                            <div class="flex items-center gap-3 mt-4 animate-enter-slide">
                                <img src="https://mc-heads.net/avatar/${topData.avatar || 'Steve'}/64" class="w-12 h-12 rounded border border-yellow-500/50 shadow-[0_0_15px_rgba(234,179,8,0.2)]">
                                <div>
                                    <div class="text-white font-bold font-mono text-lg">${topData.name || 'Anonymous'}</div>
                                    <div class="text-xs text-yellow-500/80 font-mono">${topData.item || 'Most Contributions'}</div>
                                </div>
                            </div>
                        `;
                    } else {
                        const pulse = topCard.querySelector('.animate-pulse');
                        if(pulse) pulse.remove();
                        topCard.innerHTML += `<div class="text-xs text-zinc-500 font-mono mt-4">Be the first to claim this spot!</div>`;
                    }
                }
            },

            loadNewsFeed: async () => {
                const container = document.getElementById('news-feed-container');
                if(!window.fetchNewsData) {
                    await new Promise(r => setTimeout(r, 500));
                }

                if(window.fetchNewsData) {
                    const posts = await window.fetchNewsData();
                    
                    if (posts.length === 0) {
                        const mockPosts = [
                            {
                                id: 'demo1',
                                title: 'Welcome to Season X!',
                                date: { seconds: Date.now()/1000 },
                                image: 'https://digitality.neocities.org/mongolvibes/Lifestealseasonx.jpg',
                                content: 'Welcome to the new update! **Lifesteal** is now active. Check out the new shop items.',
                                tags: ['DEV UPDATES'],
                                author: 'Admin',
                                category: 'updates'
                            },
                            {
                                id: 'demo2',
                                title: 'Weekend Event: Koth',
                                date: { seconds: (Date.now()/1000) - 86400 },
                                image: 'https://digitality.neocities.org/mongolvibes/seasonxlobby.png',
                                content: 'Join us this weekend for double heart drops on player kills.',
                                tags: ['EVENT'],
                                author: 'Admin',
                                category: 'events'
                            },
                             {
                                id: 'demo3',
                                title: 'Patch Notes 2.20',
                                date: { seconds: (Date.now()/1000) - 172800 },
                                image: '',
                                content: 'This is a test.',
                                tags: ['UPDATE'],
                                author: 'Pekly',
                                category: 'updates'
                            }
                        ];
                        app.state.newsCache = mockPosts;
                        app.renderNewsPosts(container, mockPosts);
                    } else {
                        app.state.newsCache = posts;
                        app.renderNewsPosts(container, posts);
                    }
                } else {
                    container.innerHTML = '<div class="text-red-500 text-center font-mono col-span-full">Connection Error: News Module Failed.</div>';
                }
            },

            renderNewsPosts: (container, posts) => {
                const filteredPosts = posts.filter(post => {
                    const category = (post.category || 'updates').toLowerCase();
                    return category === app.state.newsFilter;
                });

                if (filteredPosts.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-12 border border-dashed border-zinc-800 rounded-xl col-span-full">
                            <p class="text-zinc-500 font-mono">No ${app.state.newsFilter} found.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = filteredPosts.map(post => {
                    const date = new Date(post.date.seconds * 1000).toLocaleDateString("en-GB"); 
                    const category = (post.category || 'update').toUpperCase();
                    const isDev = category === 'DEV UPDATE' || category === 'UPDATES';
                    const catColor = isDev ? 'text-red-400' : 'text-green-400';
                    
                    return `
                        <div class="news-card-clean rounded-xl overflow-hidden cursor-pointer group flex flex-col h-full" onclick="app.openNewsModal('${post.id}')">
                            <div class="relative bg-zinc-900 h-48 overflow-hidden">
                                ${post.image 
                                    ? `<img src="${post.image}" class="news-image w-full h-full transition-transform duration-700 group-hover:scale-105" alt="${post.title}">` 
                                    : `<div class="w-full h-full flex items-center justify-center bg-zinc-800/50"><i class="fas fa-image text-zinc-700 text-3xl"></i></div>`
                                }
                                <div class="absolute top-3 left-3 bg-black/60 backdrop-blur px-2 py-1 rounded text-[10px] font-bold tracking-widest text-white border border-white/10">
                                    ${date}
                                </div>
                            </div>
                            
                            <div class="p-5 flex flex-col flex-1">
                                <div class="text-[10px] font-bold font-mono tracking-widest mb-2 ${catColor} opacity-80">
                                    <i class="fas fa-circle text-[6px] mr-1 align-middle"></i> ${category}
                                </div>

                                <h3 class="text-lg text-white font-bold leading-tight mb-3 font-sans group-hover:text-brand-accent transition-colors">${post.title}</h3>
                                
                                <p class="text-xs text-zinc-400 font-sans line-clamp-2 leading-relaxed mb-4 flex-1">
                                    ${post.content.replace(/[#*`]/g, '')}
                                </p>
                                
                                <div class="flex items-center gap-2 pt-4 border-t border-white/5 mt-auto">
                                    <span class="text-[10px] text-zinc-500 font-mono group-hover:text-white transition-colors">Read Article</span>
                                    <i class="fas fa-arrow-right text-[10px] text-zinc-500 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            },

            showJoinToast: (playerName) => { /* Deprecated, replaced by showToast */ },
            
            showToast: (playerName, type) => {
                const container = document.getElementById('toast-container');
                if (!container) return;

                const toast = document.createElement('div');
                toast.className = `join-toast ${type === 'join' ? 'toast-join' : 'toast-leave'}`;
                
                const isGeneric = playerName.includes('players');
                const headUrl = isGeneric ? 'https://mc-heads.net/avatar/Steve/32' : `https://mc-heads.net/avatar/${playerName}/32`;
                
                const titleColor = type === 'join' ? 'text-blue-400' : 'text-red-400';
                const message = type === 'join' ? 'JOINED THE SERVER!' : 'LEFT THE SERVER';

                toast.innerHTML = `
                    <img src="${headUrl}" class="w-8 h-8 rounded bg-zinc-800" alt="Head">
                    <div>
                        <div class="text-white font-pixel text-[10px] tracking-wider">${playerName}</div>
                        <div class="${titleColor} font-mono text-[9px] font-bold">${message}</div>
                    </div>
                `;

                container.appendChild(toast);

                // Animate in
                setTimeout(() => {
                    toast.classList.add('active');
                }, 50);

                // Animate out and remove
                setTimeout(() => {
                    toast.classList.remove('active');
                    setTimeout(() => {
                        toast.remove();
                    }, 500);
                }, 5000); 
            },

            fetchStatus: async () => {
                const dot = document.getElementById('status-dot');
                const text = document.getElementById('server-status');
                const reloadIcon = document.getElementById('reload-icon');
                
                // Only show "Pinging..." visual on the very first load to avoid flickering every 5s
                if (!app.state.statusCache) {
                    if(reloadIcon) reloadIcon.classList.add('fa-spin');
                    if(text) text.innerText = "Pinging...";
                    if(dot) dot.className = "relative inline-flex rounded-full h-3 w-3 bg-yellow-500 animate-pulse";
                }

                try {
                    const response = await fetch(`https://api.mcsrvstat.us/2/${app.state.serverIP}`);
                    const data = await response.json();
                    
                    let hasChanged = false;

                    // DETECT CHANGES (Joins/Leaves/Online Status)
                    if (app.state.statusCache) {
                        // If online status changed, that's a big change
                        if (app.state.statusCache.online !== data.online) {
                            hasChanged = true;
                        } 
                        // If both are online, check player list diffs
                        else if (data.online) {
                            const oldPlayers = app.state.statusCache.players?.list || [];
                            const newPlayers = data.players?.list || [];
                            
                            // Find players present in new list but not in old list (Joins)
                            const joinedPlayers = newPlayers.filter(p => !oldPlayers.includes(p));
                            // Find players present in old list but not in new list (Leaves)
                            const leftPlayers = oldPlayers.filter(p => !newPlayers.includes(p));
                            
                            // Handle Joins
                            if (joinedPlayers.length > 0) {
                                hasChanged = true; // Mark as changed to trigger UI update
                                if (joinedPlayers.length <= 3) {
                                    joinedPlayers.forEach(player => app.showToast(player, 'join'));
                                } else {
                                    app.showToast(`${joinedPlayers.length} players`, 'join');
                                }
                            }

                            // Handle Leaves
                            if (leftPlayers.length > 0) {
                                hasChanged = true; // Mark as changed to trigger UI update
                                if (leftPlayers.length <= 3) {
                                    leftPlayers.forEach(player => app.showToast(player, 'leave'));
                                } else {
                                    app.showToast(`${leftPlayers.length} players`, 'leave');
                                }
                            }
                            
                            // Also check if just the count changed (e.g. anonymous players)
                            if (app.state.statusCache.players.online !== data.players.online) {
                                hasChanged = true;
                            }
                        }
                    } else {
                        // First load is always a "change"
                        hasChanged = true;
                    }

                    app.state.statusCache = data;
                    
                    // Always update text status (it's lightweight and doesn't cause animation jumps)
                    if (data.online) {
                        if(dot) dot.className = "relative inline-flex rounded-full h-3 w-3 bg-green-500 shadow-[0_0_10px_#22c55e]";
                        if(text) {
                            text.innerText = `${data.players.online} Online`;
                            text.classList.add('text-brand-accent');
                        }
                        // Splash text logic (only on first specific loads if needed)
                        if (!app.state.addedPlayerSplash && data.players?.list?.length > 0) {
                             const randomPlayer = data.players.list[Math.floor(Math.random() * data.players.list.length)];
                             app.splashTexts.push(`${randomPlayer} is playing!`);
                             app.state.addedPlayerSplash = true;
                             app.setRandomSplash(); 
                        }
                    } else {
                         if(dot) dot.className = "relative inline-flex rounded-full h-3 w-3 bg-red-500";
                         if(text) {
                             text.innerText = "Offline";
                             text.classList.remove('text-brand-accent');
                         }
                    }

                    // ONLY Re-render heavy widgets if something actually changed
                    // This prevents the entrance animations from playing every 5 seconds
                    if (hasChanged) {
                        if(document.getElementById('ip-modal') && document.getElementById('ip-modal').classList.contains('active')) {
                            app.renderPlayerList(data);
                        }
                        app.updateHomePlayerCount();
                    }

                } catch (e) {
                    console.error("Status fetch failed:", e);
                    if(dot) dot.className = "relative inline-flex rounded-full h-3 w-3 bg-red-500";
                    if(text) text.innerText = "Error";
                } finally {
                    if(reloadIcon) reloadIcon.classList.remove('fa-spin');
                }
            },

            fetchDiscordStatus: async () => {
                try {
                    const response = await fetch('https://discord.com/api/guilds/937693114183847949/widget.json');
                    const data = await response.json();
                    app.state.discordCache = data;
                    if (document.getElementById('discord-modal') && document.getElementById('discord-modal').classList.contains('active')) {
                        app.renderDiscordInfo(data);
                    }
                } catch(e) {
                    console.error("Discord fetch failed:", e);
                }
            },

            renderDiscordInfo: (data) => {
                if(!data) return;
                document.getElementById('discord-server-name').innerText = data.name;
                document.getElementById('discord-online-count').innerText = data.presence_count;
                const membersContainer = document.getElementById('discord-members-preview');
                if (data.members && data.members.length > 0) {
                    membersContainer.innerHTML = data.members.slice(0, 3).map(member => `
                        <img src="${member.avatar_url}" class="w-8 h-8 rounded-full border-2 border-zinc-900 bg-zinc-800" title="${member.username}">
                    `).join('');
                    if (data.members.length > 3) {
                        membersContainer.innerHTML += `
                            <div class="w-8 h-8 rounded-full border-2 border-zinc-900 bg-zinc-800 flex items-center justify-center text-[9px] font-bold text-zinc-400">
                                +${data.presence_count - 3}
                            </div>
                        `;
                    }
                }
            },

            renderPlayerList: (data) => {
                const container = document.getElementById('player-list-container');
                if (!data || !data.players || !data.players.list || data.players.list.length === 0) {
                    container.innerHTML = '<div class="col-span-full flex flex-col items-center justify-center h-full text-zinc-600 gap-2"><i class="fas fa-ghost text-2xl"></i><span class="text-xs font-mono">No players visible</span></div>';
                    return;
                }

                container.innerHTML = data.players.list.map(player => `
                    <div class="flex items-center gap-3 p-2 rounded bg-white/5 hover:bg-white/10 transition-colors border border-transparent hover:border-white/10 cursor-default">
                        <img src="https://mc-heads.net/avatar/${player}/64" class="w-8 h-8 rounded bg-zinc-900 shadow-sm" alt="${player}">
                        <span class="text-sm font-mono text-zinc-300 font-bold tracking-wide">${player}</span>
                    </div>
                `).join('');
            },

            openIPModal: () => {
                const modal = document.getElementById('ip-modal');
                modal.classList.add('active');
                if (app.state.statusCache) app.renderPlayerList(app.state.statusCache);
                app.fetchStatus();
                app.initTiltEffect();
            },

            closeIPModal: () => {
                document.getElementById('ip-modal').classList.remove('active');
            },

            openNewsModal: async (id) => {
                const modal = document.getElementById('news-modal');
                const contentArea = document.getElementById('news-content-area');
                
                contentArea.innerHTML = `<div class="h-full flex items-center justify-center text-brand-accent"><i class="fas fa-spinner fa-spin text-3xl"></i></div>`;
                modal.classList.add('active');
                
                window.location.hash = `news/${id}`;

                let post = null;
                const cached = app.state.newsCache.find(p => p.id === id);
                if(cached) {
                    post = cached;
                } else if (window.fetchSingleNews) {
                    post = await window.fetchSingleNews(id);
                }

                if (!post) {
                    contentArea.innerHTML = `<div class="p-8 text-center text-red-400 font-mono h-full flex items-center justify-center">Transmission Interrupted: Post not found or database offline.</div>`;
                    return;
                }

                app.updateSeo(
                    `MongolVibes News | ${post.title}`, 
                    post.content.substring(0, 150).replace(/[#*`]/g, '') + '...', 
                    post.image || app.state.defaultSeo.image
                );

                const date = new Date(post.date.seconds * 1000).toLocaleDateString("en-US", { year: 'numeric', month: 'long', day: 'numeric' });

                contentArea.innerHTML = `
                    <div class="max-w-4xl mx-auto p-6 md:p-12 pb-24">
                        <div class="mb-8">
                             ${post.image ? `<img src="${post.image}" class="w-full h-64 md:h-[500px] object-cover rounded-xl border border-white/10 shadow-2xl mb-8">` : ''}
                             <div class="flex items-center gap-4 mb-6 pb-6 border-b border-white/5">
                                <img src="${app.state.adminAvatar}" class="w-12 h-12 rounded-full border border-brand-accent/30">
                                <div>
                                    <h1 class="text-3xl md:text-5xl text-white font-pixel leading-tight mb-2">${post.title}</h1>
                                    <p class="text-zinc-400 font-mono text-sm mb-3 border-l-2 border-brand-accent pl-3 italic">
                                        ${post.description || post.content.substring(0, 100).replace(/[#*`]/g, '') + '...'}
                                    </p>
                                    <div class="text-xs text-brand-accent font-mono uppercase tracking-widest flex items-center gap-3">
                                        <span>Posted by ${post.author || 'Admin'}</span>
                                        <span class="w-1 h-1 bg-zinc-500 rounded-full"></span>
                                        <span>${date}</span>
                                        <span class="w-1 h-1 bg-zinc-500 rounded-full"></span>
                                        <span class="border border-brand-accent/30 px-2 rounded text-brand-accent">${(post.category || 'update').toUpperCase()}</span>
                                    </div>
                                </div>
                             </div>
                        </div>
                        <div class="markdown-body text-zinc-300 text-lg leading-relaxed">
                            ${marked.parse(post.content)}
                        </div>
                    </div>
                `;
            },

            closeNewsModal: () => {
                document.getElementById('news-modal').classList.remove('active');
                if(window.location.hash.startsWith('#news/')) {
                     window.location.hash = 'news';
                }
                app.updateSeo(app.state.defaultSeo.title, app.state.defaultSeo.desc, app.state.defaultSeo.image);
            },

            openDiscordModal: () => {
                const modal = document.getElementById('discord-modal');
                modal.classList.add('active');
                if (app.state.discordCache) app.renderDiscordInfo(app.state.discordCache);
                app.fetchDiscordStatus();
                app.initTiltEffect();
            },

            closeDiscordModal: () => {
                document.getElementById('discord-modal').classList.remove('active');
            },

            openScreenshotModal: (imageSrc) => {
                document.getElementById('screenshot-image').src = imageSrc;
                document.getElementById('screenshot-modal').classList.add('active');
            },

            closeScreenshotModal: () => {
                document.getElementById('screenshot-modal').classList.remove('active');
            },

            closeAllModals: () => {
                document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
                document.getElementById('news-modal').classList.remove('active');
                if(window.location.hash.includes('news/')) window.location.hash = 'news';
                app.updateSeo(app.state.defaultSeo.title, app.state.defaultSeo.desc, app.state.defaultSeo.image);
            },

            copyIPFromModal: () => {
                document.execCommand('copy'); 
                navigator.clipboard.writeText(app.state.serverIP); 
                const btn = document.getElementById('copy-feedback-modal');
                if(btn) {
                    btn.classList.remove('opacity-0');
                    setTimeout(() => {
                        btn.classList.add('opacity-0');
                    }, 1500);
                }
            },

            openPaymentModal: (rank, price, perks, originalPrice) => {
                const modal = document.getElementById('payment-modal');
                document.getElementById('pay-rank-name').innerText = rank;
                
                const priceContainer = document.getElementById('pay-price-container');
                if (originalPrice && originalPrice !== '') {
                    priceContainer.innerHTML = `<p class="text-brand-accent font-mono text-xl"><span class="line-through text-zinc-500 text-sm mr-2">${originalPrice}</span>${price}</p>`;
                } else {
                    priceContainer.innerHTML = `<p class="text-brand-accent font-mono text-xl">${price}</p>`;
                }

                const perksContainer = document.getElementById('pay-rank-perks');
                perksContainer.innerHTML = perks.map(p => `
                    <li class="flex items-center gap-3">
                        <i class="fas fa-check text-brand-accent text-[10px]"></i> ${p}
                    </li>
                `).join('');
                modal.classList.add('active');
                app.initTiltEffect();
            },

            closePaymentModal: () => {
                document.getElementById('payment-modal').classList.remove('active');
            },

            initRecapPopup: () => {
                if (localStorage.getItem('mnvibes_recap_2025_seen')) return;
                
                // Initial start
                setTimeout(() => {
                    app.showRecapPopup();
                }, 3000); 
            },

            showRecapPopup: () => {
                if (localStorage.getItem('mnvibes_recap_2025_seen')) return;

                const popup = document.getElementById('recap-popup');
                if (popup) {
                    popup.classList.remove('hidden');
                    // Force reflow
                    void popup.offsetWidth;
                    popup.classList.remove('translate-y-10', 'opacity-0');

                    // Auto hide after 15 seconds
                    if (app.state.recapTimer) clearTimeout(app.state.recapTimer);
                    app.state.recapTimer = setTimeout(app.autoHideRecapPopup, 15000);
                }
            },

            autoHideRecapPopup: () => {
                const popup = document.getElementById('recap-popup');
                if (popup) {
                    popup.classList.add('translate-y-10', 'opacity-0');
                    
                    setTimeout(() => {
                        popup.classList.add('hidden');
                        // Show again after 60 seconds
                        if (app.state.recapTimer) clearTimeout(app.state.recapTimer);
                        app.state.recapTimer = setTimeout(app.showRecapPopup, 60000);
                    }, 500); // Wait for transition
                }
            },

            closeRecapPopup: () => {
                const popup = document.getElementById('recap-popup');
                if (popup) {
                    popup.classList.add('translate-y-10', 'opacity-0');
                    setTimeout(() => {
                        popup.classList.add('hidden');
                    }, 500);
                }
                localStorage.setItem('mnvibes_recap_2025_seen', 'true');
                if (app.state.recapTimer) clearTimeout(app.state.recapTimer);
            },

            loadDynamicSplash: async () => {
                const splash = document.getElementById('splash-text');
                if(!splash) return;

                app.setRandomSplash();

                if (window.fetchRecentPurchases) {
                    try {
                        const supporters = await window.fetchRecentPurchases();
                        if (supporters && supporters.length > 0) {
                            const randomSupporter = supporters[Math.floor(Math.random() * supporters.length)];
                            if (randomSupporter && randomSupporter.name) {
                                const text = `Thank u, ${randomSupporter.name}!`;
                                app.splashTexts.push(text);
                                
                                app.setRandomSplash();
                            }
                        }
                    } catch (e) {
                        console.log("Could not load dynamic supporter splash");
                    }
                }
            },

            setRandomSplash: () => {
                const splash = document.getElementById('splash-text');
                if(splash) {
                    const randomText = app.splashTexts[Math.floor(Math.random() * app.splashTexts.length)];
                    splash.innerText = randomText;
                }
            },
            
            initListeners: () => {
                document.addEventListener('keydown', (e) => {
                    if (e.key === "Escape") app.closeAllModals();
                });

                const newsContent = document.getElementById('news-content-area');
                const newsBar = document.getElementById('news-reader-bar');
                let lastScroll = 0;

                if(newsContent && newsBar) {
                    newsContent.addEventListener('scroll', () => {
                        const currentScroll = newsContent.scrollTop;
                        if (currentScroll > 50 && currentScroll > lastScroll) {
                            newsBar.style.transform = 'translateY(-100%)';
                        } else {
                            newsBar.style.transform = 'translateY(0)';
                        }
                        lastScroll = currentScroll;
                    });
                }
            },

            init: () => {
                console.log("Designed And Made By Pekly (MNVIBES Website v2)");
                app.initListeners();
                app.loadDynamicSplash(); 
                app.initRecapPopup(); // Initialize the popup

                const hash = window.location.hash.replace('#', '');
                
                if (hash.startsWith('news/')) {
                    app.routerWithCooldown(hash);
                } else {
                    const validRoutes = ['home', 'community', 'store', 'news'];
                    const initialRoute = validRoutes.includes(hash) ? hash : 'home';
                    app.routerWithCooldown(initialRoute);
                }

                setTimeout(() => {
                    app.initTiltEffect();
                    const startPage = app.state.lastActivePage || 'home';
                    const activeBtn = document.querySelector(`button[data-target="${startPage}"]`);
                    if(activeBtn) app.updateNavHighlight(activeBtn);
                }, 100);

                app.fetchStatus();
                // Changed from 30000 (30s) to 5000 (5s) for near real-time updates
                setInterval(app.fetchStatus, 5000);
                app.fetchDiscordStatus();
                
                const loadingScreen = document.getElementById('loading-screen');
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }
        };

        document.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>
